!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.MicRecorder=t()}(this,function(){function e(e){return new Int16Array(e)}function t(e){return new Int32Array(e)}function a(e){return new Float32Array(e)}function s(e){if(1==e.length)return a(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(s(e));return n}function n(e){if(1==e.length)return t(e[0]);var a=e[0];e=e.slice(1);for(var s=[],r=0;r<a;r++)s.push(n(e));return s}function r(t){if(1==t.length)return e(t[0]);var a=t[0];t=t.slice(1);for(var s=[],n=0;n<a;n++)s.push(r(t));return s}function i(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],s=0;s<t;s++)a.push(i(e));return a}function _(e){this.ordinal=e}function o(e){this.ordinal=e}function l(){function e(e){var t,a;if(0!=e.ATH.useAdjust)if(a=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(a+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(a+=a,t+=t),2==e.mode_gr&&(a=Math.max(a,t)),a*=.5,(a*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var s=31.98*a+625e-6;e.ATH.adjust>=s?(e.ATH.adjust*=.075*s+.925,e.ATH.adjust<s&&(e.ATH.adjust=s)):e.ATH.adjustLimit>=s?e.ATH.adjust=s:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=s}else e.ATH.adjust=1}function t(e){var t,a;for(z(0<=e.bitrate_index&&e.bitrate_index<16),z(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(a=0;a<e.channels_out;++a){var s=0|e.l3_side.tt[t][a].block_type;0!=e.l3_side.tt[t][a].mixed_block_flag&&(s=4),e.bitrate_blockType_Hist[e.bitrate_index][s]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][s]++,e.bitrate_blockType_Hist[15][5]++}}function a(e,t){var a,s,n=e.internal_flags;if(0==n.lame_encode_frame_init){var r,i,_=C(2014),o=C(2014);for(n.lame_encode_frame_init=1,r=0,i=0;r<286+576*(1+n.mode_gr);++r)r<576*n.mode_gr?(_[r]=0,2==n.channels_out&&(o[r]=0)):(_[r]=t[0][i],2==n.channels_out&&(o[r]=t[1][i]),++i);for(s=0;s<n.mode_gr;s++)for(a=0;a<n.channels_out;a++)n.l3_side.tt[s][a].block_type=l.SHORT_TYPE;h.mdct_sub48(n,_,o),z(576>=l.FFTOFFSET),z(n.mf_size>=l.BLKSIZE+e.framesize-l.FFTOFFSET),z(n.mf_size>=512+e.framesize-32)}}var s=H,n=D,r=l.FFTOFFSET,i=l.MPG_MD_MS_LR,_=null;this.psy=null;var o=null,f=null,c=null;this.setModules=function(e,t,a,s){_=e,this.psy=t,o=t,f=s,c=a};var h=new s;this.lame_encode_mp3_frame=function(s,u,b,m,p,d){var v,g=F([2,2]);g[0][0]=new n,g[0][1]=new n,g[1][0]=new n,g[1][1]=new n;var S=F([2,2]);S[0][0]=new n,S[0][1]=new n,S[1][0]=new n,S[1][1]=new n;var M,R,A,B,w=[null,null],E=s.internal_flags,T=G([2,4]),y=[.5,.5],k=[[0,0],[0,0]],x=[[0,0],[0,0]];if(w[0]=u,w[1]=b,0==E.lame_encode_frame_init&&a(s,w),E.padding=0,(E.slot_lag-=E.frac_SpF)<0&&(E.slot_lag+=s.out_samplerate,E.padding=1),0!=E.psymodel){var P=[null,null],I=0,L=j(2);for(B=0;B<E.mode_gr;B++){for(A=0;A<E.channels_out;A++)P[A]=w[A],I=576+576*B-l.FFTOFFSET;if(0!=(s.VBR==q.vbr_mtrh||s.VBR==q.vbr_mt?o.L3psycho_anal_vbr(s,P,I,B,g,S,k[B],x[B],T[B],L):o.L3psycho_anal_ns(s,P,I,B,g,S,k[B],x[B],T[B],L)))return-4;for(s.mode==MPEGMode.JOINT_STEREO&&(y[B]=T[B][2]+T[B][3],y[B]>0&&(y[B]=T[B][3]/y[B])),A=0;A<E.channels_out;A++){var H=E.l3_side.tt[B][A];H.block_type=L[A],H.mixed_block_flag=0}}}else for(B=0;B<E.mode_gr;B++)for(A=0;A<E.channels_out;A++)E.l3_side.tt[B][A].block_type=l.NORM_TYPE,E.l3_side.tt[B][A].mixed_block_flag=0,x[B][A]=k[B][A]=700;if(e(E),h.mdct_sub48(E,w[0],w[1]),E.mode_ext=l.MPG_MD_LR_LR,s.force_ms)E.mode_ext=l.MPG_MD_MS_LR;else if(s.mode==MPEGMode.JOINT_STEREO){var V=0,N=0;for(B=0;B<E.mode_gr;B++)for(A=0;A<E.channels_out;A++)V+=x[B][A],N+=k[B][A];if(V<=1*N){var O=E.l3_side.tt[0],X=E.l3_side.tt[E.mode_gr-1];O[0].block_type==O[1].block_type&&X[0].block_type==X[1].block_type&&(E.mode_ext=l.MPG_MD_MS_LR)}}if(E.mode_ext==i?(M=S,R=x):(M=g,R=k),s.analysis&&null!=E.pinfo)for(B=0;B<E.mode_gr;B++)for(A=0;A<E.channels_out;A++)E.pinfo.ms_ratio[B]=E.ms_ratio[B],E.pinfo.ms_ener_ratio[B]=y[B],E.pinfo.blocktype[B][A]=E.l3_side.tt[B][A].block_type,E.pinfo.pe[B][A]=R[B][A],Y.arraycopy(E.l3_side.tt[B][A].xr,0,E.pinfo.xr[B][A],0,576),E.mode_ext==i&&(E.pinfo.ers[B][A]=E.pinfo.ers[B][A+2],Y.arraycopy(E.pinfo.energy[B][A+2],0,E.pinfo.energy[B][A],0,E.pinfo.energy[B][A].length));if(s.VBR==q.vbr_off||s.VBR==q.vbr_abr){var D,C;for(D=0;D<18;D++)E.nsPsy.pefirbuf[D]=E.nsPsy.pefirbuf[D+1];for(C=0,B=0;B<E.mode_gr;B++)for(A=0;A<E.channels_out;A++)C+=R[B][A];for(E.nsPsy.pefirbuf[18]=C,C=E.nsPsy.pefirbuf[9],D=0;D<9;D++)C+=(E.nsPsy.pefirbuf[D]+E.nsPsy.pefirbuf[18-D])*l.fircoef[D];for(C=3350*E.mode_gr*E.channels_out/C,B=0;B<E.mode_gr;B++)for(A=0;A<E.channels_out;A++)R[B][A]*=C}if(E.iteration_loop.iteration_loop(s,R,y,M),_.format_bitstream(s),v=_.copy_buffer(E,m,p,d,1),s.bWriteVbrTag&&f.addVbrFrame(s),s.analysis&&null!=E.pinfo){for(A=0;A<E.channels_out;A++){var z;for(z=0;z<r;z++)E.pinfo.pcmdata[A][z]=E.pinfo.pcmdata[A][z+s.framesize];for(z=r;z<1600;z++)E.pinfo.pcmdata[A][z]=w[A][z-r]}c.set_frame_pinfo(s,M)}return t(E),v}}function f(e){var t=e;this.ordinal=function(){return t}}function c(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Te([2,c.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new me,this.ms_ratio=Ee(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=ye(2),this.CurrentStep=ye(2),this.masking_lower=0,this.bv_scf=ye(576),this.pseudohalf=ye(fe.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*c.BPC+1),this.itime=we(2),this.sideinfo_len=0,this.sb_sample=Te([2,2,18,K.SBLIMIT]),this.amp_filter=Ee(32),this.header=new Array(c.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new ve,this.minval_l=Ee(K.CBANDS),this.minval_s=Ee(K.CBANDS),this.nb_1=Te([4,K.CBANDS]),this.nb_2=Te([4,K.CBANDS]),this.nb_s1=Te([4,K.CBANDS]),this.nb_s2=Te([4,K.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ee(4),this.loudness_sq=Te([2,2]),this.loudness_sq_save=Ee(2),this.mld_l=Ee(K.SBMAX_l),this.mld_s=Ee(K.SBMAX_s),this.bm_l=ye(K.SBMAX_l),this.bo_l=ye(K.SBMAX_l),this.bm_s=ye(K.SBMAX_s),this.bo_s=ye(K.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=ke([K.CBANDS,2]),this.s3ind_s=ke([K.CBANDS,2]),this.numlines_s=ye(K.CBANDS),this.numlines_l=ye(K.CBANDS),this.rnumlines_l=Ee(K.CBANDS),this.mld_cb_l=Ee(K.CBANDS),this.mld_cb_s=Ee(K.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ee(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=ye(2),this.nsPsy=new Re,this.VBR_seek_table=new Ae,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=ke([16,5]),this.bitrate_blockType_Hist=ke([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(t=0;t<this.en.length;t++)this.en[t]=new X;for(t=0;t<this.thm.length;t++)this.thm[t]=new X;for(var t=0;t<this.header.length;t++)this.header[t]=new function(){this.write_timing=0,this.ptr=0,this.buf=Be(e)}}function h(){function e(e,t,a,s,n,r){for(;0!=n--;)a[s]=1e-10+e[t+0]*r[0]-a[s-1]*r[1]+e[t-1]*r[2]-a[s-2]*r[3]+e[t-2]*r[4]-a[s-3]*r[5]+e[t-3]*r[6]-a[s-4]*r[7]+e[t-4]*r[8]-a[s-5]*r[9]+e[t-5]*r[10]-a[s-6]*r[11]+e[t-6]*r[12]-a[s-7]*r[13]+e[t-7]*r[14]-a[s-8]*r[15]+e[t-8]*r[16]-a[s-9]*r[17]+e[t-9]*r[18]-a[s-10]*r[19]+e[t-10]*r[20],++s,++t}function t(e,t,a,s,n,r){for(;0!=n--;)a[s]=e[t+0]*r[0]-a[s-1]*r[1]+e[t-1]*r[2]-a[s-2]*r[3]+e[t-2]*r[4],++s,++t}function a(e,t){for(var a=0;a<MAX_ORDER;a++)e.linprebuf[a]=e.lstepbuf[a]=e.loutbuf[a]=e.rinprebuf[a]=e.rstepbuf[a]=e.routbuf[a]=0;switch(0|t){case 48e3:e.reqindex=0;break;case 44100:e.reqindex=1;break;case 32e3:e.reqindex=2;break;case 24e3:e.reqindex=3;break;case 22050:e.reqindex=4;break;case 16e3:e.reqindex=5;break;case 12e3:e.reqindex=6;break;case 11025:e.reqindex=7;break;case 8e3:e.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return e.sampleWindow=0|(t*_+o-1)/o,e.lsum=0,e.rsum=0,e.totsamp=0,He.ill(e.A,0),INIT_GAIN_ANALYSIS_OK}function s(e){return e*e}function n(e,t){var a,s=0;for(a=0;a<t;a++)s+=e[a];if(0==s)return GAIN_NOT_ENOUGH_SAMPLES;var n=0|Math.ceil(s*(1-i));for(a=t;a-- >0&&!((n-=e[a])<=0););return r-a/h.STEPS_per_dB}var r=64.82,i=(h.YULE_ORDER,.95),_=(h.MAX_SAMP_FREQ,h.RMS_WINDOW_TIME_NUMERATOR),o=h.RMS_WINDOW_TIME_DENOMINATOR,l=(h.MAX_SAMPLES_PER_WINDOW,[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]]),f=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];this.InitGainAnalysis=function(e,t){return a(e,t)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(e.linpre=MAX_ORDER,e.rinpre=MAX_ORDER,e.lstep=MAX_ORDER,e.rstep=MAX_ORDER,e.lout=MAX_ORDER,e.rout=MAX_ORDER,He.fill(e.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(a,n,r,i,_,o,c){var u,b,m,p,d,v,g;if(0==o)return GAIN_ANALYSIS_OK;switch(g=0,d=o,c){case 1:i=n,_=r;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(o<MAX_ORDER?(Le.arraycopy(n,r,a.linprebuf,MAX_ORDER,o),Le.arraycopy(i,_,a.rinprebuf,MAX_ORDER,o)):(Le.arraycopy(n,r,a.linprebuf,MAX_ORDER,MAX_ORDER),Le.arraycopy(i,_,a.rinprebuf,MAX_ORDER,MAX_ORDER));d>0;){v=d>a.sampleWindow-a.totsamp?a.sampleWindow-a.totsamp:d,g<MAX_ORDER?(u=a.linpre+g,b=a.linprebuf,m=a.rinpre+g,p=a.rinprebuf,v>MAX_ORDER-g&&(v=MAX_ORDER-g)):(u=r+g,b=n,m=_+g,p=i),e(b,u,a.lstepbuf,a.lstep+a.totsamp,v,l[a.reqindex]),e(p,m,a.rstepbuf,a.rstep+a.totsamp,v,l[a.reqindex]),t(a.lstepbuf,a.lstep+a.totsamp,a.loutbuf,a.lout+a.totsamp,v,f[a.reqindex]),t(a.rstepbuf,a.rstep+a.totsamp,a.routbuf,a.rout+a.totsamp,v,f[a.reqindex]),u=a.lout+a.totsamp,b=a.loutbuf,m=a.rout+a.totsamp,p=a.routbuf;for(var S=v%8;0!=S--;)a.lsum+=s(b[u++]),a.rsum+=s(p[m++]);for(S=v/8;0!=S--;)a.lsum+=s(b[u+0])+s(b[u+1])+s(b[u+2])+s(b[u+3])+s(b[u+4])+s(b[u+5])+s(b[u+6])+s(b[u+7]),u+=8,a.rsum+=s(p[m+0])+s(p[m+1])+s(p[m+2])+s(p[m+3])+s(p[m+4])+s(p[m+5])+s(p[m+6])+s(p[m+7]),m+=8;if(d-=v,g+=v,a.totsamp+=v,a.totsamp==a.sampleWindow){var M=10*h.STEPS_per_dB*Math.log10((a.lsum+a.rsum)/a.totsamp*.5+1e-37),R=M<=0?0:0|M;R>=a.A.length&&(R=a.A.length-1),a.A[R]++,a.lsum=a.rsum=0,Le.arraycopy(a.loutbuf,a.totsamp,a.loutbuf,0,MAX_ORDER),Le.arraycopy(a.routbuf,a.totsamp,a.routbuf,0,MAX_ORDER),Le.arraycopy(a.lstepbuf,a.totsamp,a.lstepbuf,0,MAX_ORDER),Le.arraycopy(a.rstepbuf,a.totsamp,a.rstepbuf,0,MAX_ORDER),a.totsamp=0}if(a.totsamp>a.sampleWindow)return GAIN_ANALYSIS_ERROR}return o<MAX_ORDER?(Le.arraycopy(a.linprebuf,o,a.linprebuf,0,MAX_ORDER-o),Le.arraycopy(a.rinprebuf,o,a.rinprebuf,0,MAX_ORDER-o),Le.arraycopy(n,r,a.linprebuf,MAX_ORDER-o,o),Le.arraycopy(i,_,a.rinprebuf,MAX_ORDER-o,o)):(Le.arraycopy(n,r+o-MAX_ORDER,a.linprebuf,0,MAX_ORDER),Le.arraycopy(i,_+o-MAX_ORDER,a.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=n(e.A,e.A.length),a=0;a<e.A.length;a++)e.B[a]+=e.A[a],e.A[a]=0;for(a=0;a<MAX_ORDER;a++)e.linprebuf[a]=e.lstepbuf[a]=e.loutbuf[a]=e.rinprebuf[a]=e.rstepbuf[a]=e.routbuf[a]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}function u(e,t,a,s){this.xlen=e,this.linmax=t,this.table=a,this.hlen=s}function b(){function e(e){return We(0<=e+b.Q_MAX2&&e<b.Q_MAX),h[e+b.Q_MAX2]}function t(e,t){var a=i.ATHformula(t,e);return a-=f,a=Math.pow(10,a/10+e.ATHlower)}function a(e){for(var a=e.internal_flags.ATH.l,s=e.internal_flags.ATH.psfb21,n=e.internal_flags.ATH.s,r=e.internal_flags.ATH.psfb12,i=e.internal_flags,_=e.out_samplerate,o=0;o<K.SBMAX_l;o++){var l=i.scalefac_band.l[o],f=i.scalefac_band.l[o+1];a[o]=Ke.MAX_VALUE;for(c=l;c<f;c++){u=t(e,h=c*_/1152);a[o]=Math.min(a[o],u)}}for(o=0;o<K.PSFB21;o++){var l=i.scalefac_band.psfb21[o],f=i.scalefac_band.psfb21[o+1];s[o]=Ke.MAX_VALUE;for(c=l;c<f;c++){u=t(e,h=c*_/1152);s[o]=Math.min(s[o],u)}}for(o=0;o<K.SBMAX_s;o++){var l=i.scalefac_band.s[o],f=i.scalefac_band.s[o+1];n[o]=Ke.MAX_VALUE;for(c=l;c<f;c++){u=t(e,h=c*_/384);n[o]=Math.min(n[o],u)}n[o]*=i.scalefac_band.s[o+1]-i.scalefac_band.s[o]}for(o=0;o<K.PSFB12;o++){var l=i.scalefac_band.psfb12[o],f=i.scalefac_band.psfb12[o+1];r[o]=Ke.MAX_VALUE;for(var c=l;c<f;c++){var h=c*_/384,u=t(e,h);r[o]=Math.min(r[o],u)}r[o]*=i.scalefac_band.s[13]-i.scalefac_band.s[12]}if(e.noATH){for(o=0;o<K.SBMAX_l;o++)a[o]=1e-20;for(o=0;o<K.PSFB21;o++)s[o]=1e-20;for(o=0;o<K.SBMAX_s;o++)n[o]=1e-20;for(o=0;o<K.PSFB12;o++)r[o]=1e-20}i.ATH.floor=10*Math.log10(t(e,-1))}function s(e){this.s=e}var n=null,r=null,i=null;this.setModules=function(e,t,a){n=e,r=t,i=a},this.IPOW20=function(e){return We(0<=e&&e<b.Q_MAX),u[e]};var _=b.IXMAX_VAL+2,o=b.Q_MAX,l=b.Q_MAX2,f=(b.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var c=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=c,this.sfBandIndex=[new ve([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new ve([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var h=Ue(o+l+1),u=Ue(o),m=Ue(_),p=Ue(_);this.adj43=p,this.iteration_init=function(e){var t,s=e.internal_flags,r=s.l3_side;if(0==s.iteration_init_init){for(s.iteration_init_init=1,r.main_data_begin=0,a(e),m[0]=0,t=1;t<_;t++)m[t]=Math.pow(t,4/3);for(t=0;t<_-1;t++)p[t]=t+1-Math.pow(.5*(m[t]+m[t+1]),.75);for(p[t]=.5,t=0;t<o;t++)u[t]=Math.pow(2,-.1875*(t-210));for(t=0;t<=o+l;t++)h[t]=Math.pow(2,.25*(t-210-l));n.huffman_init(s);var i,f,c,b;for((t=e.exp_nspsytune>>2&63)>=32&&(t-=64),i=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>8&63)>=32&&(t-=64),f=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>14&63)>=32&&(t-=64),c=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>20&63)>=32&&(t-=64),b=c*Math.pow(10,t/4/10),t=0;t<K.SBMAX_l;t++){d=t<=6?i:t<=13?f:t<=20?c:b,s.nsPsy.longfact[t]=d}for(t=0;t<K.SBMAX_s;t++){var d;d=t<=5?i:t<=10?f:t<=11?c:b,s.nsPsy.shortfact[t]=d}}},this.on_pe=function(e,t,a,s,n,i){var _,o,l=e.internal_flags,f=0,c=Qe(2),h=new De(f),u=r.ResvMaxBits(e,s,h,i),b=(f=h.bits)+u;for(b>xe.MAX_BITS_PER_GRANULE&&(b=xe.MAX_BITS_PER_GRANULE),_=0,o=0;o<l.channels_out;++o)a[o]=Math.min(xe.MAX_BITS_PER_CHANNEL,f/l.channels_out),c[o]=0|a[o]*t[n][o]/700-a[o],c[o]>3*s/4&&(c[o]=3*s/4),c[o]<0&&(c[o]=0),c[o]+a[o]>xe.MAX_BITS_PER_CHANNEL&&(c[o]=Math.max(0,xe.MAX_BITS_PER_CHANNEL-a[o])),_+=c[o];if(_>u)for(o=0;o<l.channels_out;++o)c[o]=u*c[o]/_;for(o=0;o<l.channels_out;++o)a[o]+=c[o],u-=c[o];for(_=0,o=0;o<l.channels_out;++o)_+=a[o];if(_>xe.MAX_BITS_PER_GRANULE){var m=0;for(o=0;o<l.channels_out;++o)a[o]*=xe.MAX_BITS_PER_GRANULE,a[o]/=_,m+=a[o];We(m<=xe.MAX_BITS_PER_GRANULE)}return b},this.reduce_side=function(e,t,a,s){We(s<=xe.MAX_BITS_PER_GRANULE),We(e[0]+e[1]<=xe.MAX_BITS_PER_GRANULE);var n=.33*(.5-t)/.5;n<0&&(n=0),n>.5&&(n=.5);var r=0|.5*n*(e[0]+e[1]);r>xe.MAX_BITS_PER_CHANNEL-e[0]&&(r=xe.MAX_BITS_PER_CHANNEL-e[0]),r<0&&(r=0),e[1]>=125&&(e[1]-r>125?(e[0]<a&&(e[0]+=r),e[1]-=r):(e[0]+=e[1]-125,e[1]=125)),(r=e[0]+e[1])>s&&(e[0]=s*e[0]/r,e[1]=s*e[1]/r),We(e[0]<=xe.MAX_BITS_PER_CHANNEL),We(e[1]<=xe.MAX_BITS_PER_CHANNEL),We(e[0]+e[1]<=xe.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,a){var s=90.30873362,n=Ze.FAST_LOG10_X(t,10),r=e*e,i=0;return n-=a,r>1e-20&&(i=1+Ze.FAST_LOG10_X(r,10/s)),i<0&&(i=0),n*=i,n+=a+s-94.82444863,Math.pow(10,.1*n)},this.calc_xmin=function(e,t,a,s){var n,r=0,i=e.internal_flags,_=0,o=0,l=i.ATH,f=a.xr,c=e.VBR==ze.vbr_mtrh?1:0,h=i.masking_lower;for(e.VBR!=ze.vbr_mtrh&&e.VBR!=ze.vbr_mt||(h=1),n=0;n<a.psy_lmax;n++){S=(g=e.VBR==ze.vbr_rh||e.VBR==ze.vbr_mtrh?athAdjust(l.adjust,l.l[n],l.floor):l.adjust*l.l[n])/(p=a.width[n]),M=2.220446049250313e-16,A=p>>1,R=0;do{R+=B=f[_]*f[_],M+=B<S?B:S,R+=w=f[++_]*f[_],M+=w<S?w:S,_++}while(--A>0);if(R>g&&o++,n==K.SBPSY_l&&M<(T=g*i.nsPsy.longfact[n])&&(M=T),0!=c&&(g=M),!e.ATHonly&&(E=t.en.l[n])>0){T=R*t.thm.l[n]*h/E,0!=c&&(T*=i.nsPsy.longfact[n]),g<T&&(g=T)}s[r++]=0!=c?g:g*i.nsPsy.longfact[n]}var u=575;if(a.block_type!=K.SHORT_TYPE)for(var b=576;0!=b--&&BitStream.EQ(f[b],0);)u=b;a.max_nonzero_coeff=u;for(var m=a.sfb_smin;n<a.psymax;m++,n+=3){var p,d,v;for(v=e.VBR==ze.vbr_rh||e.VBR==ze.vbr_mtrh?athAdjust(l.adjust,l.s[m],l.floor):l.adjust*l.s[m],p=a.width[n],d=0;d<3;d++){var g,S,M,R=0,A=p>>1;S=v/p,M=2.220446049250313e-16;do{var B,w;R+=B=f[_]*f[_],M+=B<S?B:S,R+=w=f[++_]*f[_],M+=w<S?w:S,_++}while(--A>0);if(R>v&&o++,m==K.SBPSY_s&&M<(T=v*i.nsPsy.shortfact[m])&&(M=T),g=0!=c?M:v,!e.ATHonly&&!e.ATHshort){var E=t.en.s[m][d];if(E>0){var T;T=R*t.thm.s[m][d]*h/E,0!=c&&(T*=i.nsPsy.shortfact[m]),g<T&&(g=T)}}s[r++]=0!=c?g:g*i.nsPsy.shortfact[m]}e.useTemporal&&(s[r-3]>s[r-3+1]&&(s[r-3+1]+=(s[r-3]-s[r-3+1])*i.decay),s[r-3+1]>s[r-3+2]&&(s[r-3+2]+=(s[r-3+1]-s[r-3+2])*i.decay))}return o},this.calc_noise_core=function(e,t,a,s){var n=0,r=t.s,i=e.l3_enc;if(r>e.count1)for(;0!=a--;){o=e.xr[r],r++,n+=o*o,o=e.xr[r],r++,n+=o*o}else if(r>e.big_values){var _=Ue(2);for(_[0]=0,_[1]=s;0!=a--;){o=Math.abs(e.xr[r])-_[i[r]],r++,n+=o*o,o=Math.abs(e.xr[r])-_[i[r]],r++,n+=o*o}}else for(;0!=a--;){var o;o=Math.abs(e.xr[r])-m[i[r]]*s,r++,n+=o*o,o=Math.abs(e.xr[r])-m[i[r]]*s,r++,n+=o*o}return t.s=r,n},this.calc_noise=function(t,a,n,r,i){var _,o,l=0,f=0,h=0,u=0,b=0,m=-20,p=0,d=t.scalefac,v=0;for(r.over_SSD=0,_=0;_<t.psymax;_++){var g=t.global_gain-(d[v++]+(0!=t.preflag?c[_]:0)<<t.scalefac_scale+1)-8*t.subblock_gain[t.window[_]],S=0;if(null!=i&&i.step[_]==g)S=i.noise[_],p+=t.width[_],n[l++]=S/a[f++],S=i.noise_log[_];else{var M=e(g);if(o=t.width[_]>>1,p+t.width[_]>t.max_nonzero_coeff){var R;o=(R=t.max_nonzero_coeff-p+1)>0?R>>1:0}var A=new s(p);S=this.calc_noise_core(t,A,o,M),p=A.s,null!=i&&(i.step[_]=g,i.noise[_]=S),S=n[l++]=S/a[f++],S=Ze.FAST_LOG10(Math.max(S,1e-20)),null!=i&&(i.noise_log[_]=S)}if(null!=i&&(i.global_gain=t.global_gain),b+=S,S>0){var B;B=Math.max(0|10*S+.5,1),r.over_SSD+=B*B,h++,u+=S}m=Math.max(m,S)}return r.over_count=h,r.tot_noise=b,r.over_noise=u,r.max_noise=m,h},this.set_pinfo=function(e,t,a,s,n){var r,i,_,o,l,f=e.internal_flags,h=0==t.scalefac_scale?.5:1,u=t.scalefac,b=Ue(L3Side.SFBMAX),m=Ue(L3Side.SFBMAX),p=new CalcNoiseResult;calc_xmin(e,a,t,b),calc_noise(t,b,m,p,null);var d=0;for(i=t.sfb_lmax,t.block_type!=K.SHORT_TYPE&&0==t.mixed_block_flag&&(i=22),r=0;r<i;r++){var v=f.scalefac_band.l[r],g=(S=f.scalefac_band.l[r+1])-v;for(o=0;d<S;d++)o+=t.xr[d]*t.xr[d];o/=g,l=1e15,f.pinfo.en[s][n][r]=l*o,f.pinfo.xfsf[s][n][r]=l*b[r]*m[r]/g,a.en.l[r]>0&&!e.ATHonly?o/=a.en.l[r]:o=0,f.pinfo.thr[s][n][r]=l*Math.max(o*a.thm.l[r],f.ATH.l[r]),f.pinfo.LAMEsfb[s][n][r]=0,0!=t.preflag&&r>=11&&(f.pinfo.LAMEsfb[s][n][r]=-h*c[r]),r<K.SBPSY_l&&(We(u[r]>=0),f.pinfo.LAMEsfb[s][n][r]-=h*u[r])}if(t.block_type==K.SHORT_TYPE)for(i=r,r=t.sfb_smin;r<K.SBMAX_s;r++)for(var v=f.scalefac_band.s[r],S=f.scalefac_band.s[r+1],g=S-v,M=0;M<3;M++){for(o=0,_=v;_<S;_++)o+=t.xr[d]*t.xr[d],d++;o=Math.max(o/g,1e-20),l=1e15,f.pinfo.en_s[s][n][3*r+M]=l*o,f.pinfo.xfsf_s[s][n][3*r+M]=l*b[i]*m[i]/g,a.en.s[r][M]>0?o/=a.en.s[r][M]:o=0,(e.ATHonly||e.ATHshort)&&(o=0),f.pinfo.thr_s[s][n][3*r+M]=l*Math.max(o*a.thm.s[r][M],f.ATH.s[r]),f.pinfo.LAMEsfb_s[s][n][3*r+M]=-2*t.subblock_gain[M],r<K.SBPSY_s&&(f.pinfo.LAMEsfb_s[s][n][3*r+M]-=h*u[i]),i++}f.pinfo.LAMEqss[s][n]=t.global_gain,f.pinfo.LAMEmainbits[s][n]=t.part2_3_length+t.part2_length,f.pinfo.LAMEsfbits[s][n]=t.part2_length,f.pinfo.over[s][n]=p.over_count,f.pinfo.max_noise[s][n]=10*p.max_noise,f.pinfo.over_noise[s][n]=10*p.over_noise,f.pinfo.tot_noise[s][n]=10*p.tot_noise,f.pinfo.over_SSD[s][n]=p.over_SSD}}function m(){function e(e){this.bits=0|e}function t(e,t,a,s,n,r){var i=.5946/t;for(at(e>0),e>>=1;0!=e--;)n[r++]=i>a[s++]?0:1,n[r++]=i>a[s++]?0:1}function a(e,t,a,s,n,r){at(e>0);var i=(e>>=1)%2;for(e>>=1;0!=e--;){var _,o,l,f;c=a[s++]*t,h=a[s++]*t,u=0|c,_=a[s++]*t,m=0|h,o=a[s++]*t,l=0|_,c+=b.adj43[u],f=0|o,h+=b.adj43[m],n[r++]=0|c,_+=b.adj43[l],n[r++]=0|h,o+=b.adj43[f],n[r++]=0|_,n[r++]=0|o}if(0!=i){var c,h,u,m;u=0|(c=a[s++]*t),m=0|(h=a[s++]*t),c+=b.adj43[u],h+=b.adj43[m],n[r++]=0|c,n[r++]=0|h}}function s(e,s,n,r,i){var _,o,l,f=0,c=0,h=0,u=0,m=s,p=0,d=m,v=0,g=e,S=0;for(l=null!=i&&r.global_gain==i.global_gain,o=r.block_type==K.SHORT_TYPE?38:21,_=0;_<=o;_++){var M=-1;if((l||r.block_type==K.NORM_TYPE)&&(M=r.global_gain-(r.scalefac[_]+(0!=r.preflag?b.pretab[_]:0)<<r.scalefac_scale+1)-8*r.subblock_gain[r.window[_]]),at(r.width[_]>=0),l&&i.step[_]==M)0!=c&&(a(c,n,g,S,d,v),c=0),0!=h&&(t(h,n,g,S,d,v),h=0);else{var R=r.width[_];if(f+r.width[_]>r.max_nonzero_coeff){var A;A=r.max_nonzero_coeff-f+1,et.fill(s,r.max_nonzero_coeff,576,0),(R=A)<0&&(R=0),_=o+1}if(0==c&&0==h&&(d=m,v=p,g=e,S=u),null!=i&&i.sfb_count1>0&&_>=i.sfb_count1&&i.step[_]>0&&M>=i.step[_]?(0!=c&&(a(c,n,g,S,d,v),c=0,d=m,v=p,g=e,S=u),h+=R):(0!=h&&(t(h,n,g,S,d,v),h=0,d=m,v=p,g=e,S=u),c+=R),R<=0){0!=h&&(t(h,n,g,S,d,v),h=0),0!=c&&(a(c,n,g,S,d,v),c=0);break}}_<=o&&(p+=r.width[_],u+=r.width[_],f+=r.width[_])}0!=c&&(a(c,n,g,S,d,v),c=0),0!=h&&(t(h,n,g,S,d,v),h=0)}function n(e,t,a){var s=0,n=0;do{var r=e[t++],i=e[t++];s<r&&(s=r),n<i&&(n=i)}while(t<a);return s<n&&(s=n),s}function r(e,t,a,s,n,r){var i,_=65536*je.ht[s].xlen+je.ht[n].xlen,o=0;do{var l=e[t++],f=e[t++];0!=l&&(l>14&&(l=15,o+=_),l*=16),0!=f&&(f>14&&(f=15,o+=_),l+=f),o+=je.largetbl[l]}while(t<a);return i=65535&o,(o>>=16)>i&&(o=i,s=n),r.bits+=o,s}function i(e,t,a,s){var n=0,r=je.ht[1].hlen;do{var i=2*e[t+0]+e[t+1];t+=2,n+=r[i]}while(t<a);return s.bits+=n,1}function _(e,t,a,s,n){var r,i,_=0,o=je.ht[s].xlen;i=2==s?je.table23:je.table56;do{var l=e[t+0]*o+e[t+1];t+=2,_+=i[l]}while(t<a);return r=65535&_,(_>>=16)>r&&(_=r,s++),n.bits+=_,s}function o(e,t,a,s,n){var r=0,i=0,_=0,o=je.ht[s].xlen,l=je.ht[s].hlen,f=je.ht[s+1].hlen,c=je.ht[s+2].hlen;do{var h=e[t+0]*o+e[t+1];t+=2,r+=l[h],i+=f[h],_+=c[h]}while(t<a);var u=s;return r>i&&(r=i,u++),r>_&&(r=_,u=s+2),n.bits+=r,u}function l(e,t,a,s){var l=n(e,t,a);switch(l){case 0:return l;case 1:return i(e,t,a,s);case 2:case 3:return _(e,t,a,d[l-1],s);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return o(e,t,a,d[l-1],s);default:if(l>Je.IXMAX_VAL)return s.bits=Je.LARGE_BITS,-1;l-=15;var f;for(f=24;f<32&&!(je.ht[f].linmax>=l);f++);var c;for(c=f-8;c<24&&!(je.ht[c].linmax>=l);c++);return r(e,t,a,c,f,s)}}function f(t,a,s,n,r,i,_){for(var o=a.big_values,f=0;f<=22;f++)n[f]=Je.LARGE_BITS;for(f=0;f<16;f++){var c=t.scalefac_band.l[f+1];if(c>=o)break;var h=0,u=new e(h),b=l(s,0,c,u);h=u.bits;for(var m=0;m<8;m++){var p=t.scalefac_band.l[f+m+2];if(p>=o)break;var d=h,v=l(s,c,p,u=new e(d));d=u.bits,n[f+m]>d&&(n[f+m]=d,r[f+m]=f,i[f+m]=b,_[f+m]=v)}}}function c(t,a,s,n,r,i,_,o){for(var f=a.big_values,c=2;c<K.SBMAX_l+1;c++){var h=t.scalefac_band.l[c];if(h>=f)break;var u=r[c-2]+a.count1bits;if(s.part2_3_length<=u)break;var b=new e(u),m=l(n,h,f,b);u=b.bits,s.part2_3_length<=u||(s.assign(a),s.part2_3_length=u,s.region0_count=i[c-2],s.region1_count=c-2-i[c-2],s.table_select[0]=_[c-2],s.table_select[1]=o[c-2],s.table_select[2]=m)}}function h(e,t){for(var a,s=t.tt[1][e],n=t.tt[0][e],r=0;r<je.scfsi_band.length-1;r++){for(a=je.scfsi_band[r];a<je.scfsi_band[r+1]&&!(n.scalefac[a]!=s.scalefac[a]&&s.scalefac[a]>=0);a++);if(a==je.scfsi_band[r+1]){for(a=je.scfsi_band[r];a<je.scfsi_band[r+1];a++)s.scalefac[a]=-1;t.scfsi[e][r]=1}}var i=0,_=0;for(a=0;a<11;a++)-1!=s.scalefac[a]&&(_++,i<s.scalefac[a]&&(i=s.scalefac[a]));for(var o=0,l=0;a<K.SBPSY_l;a++)-1!=s.scalefac[a]&&(l++,o<s.scalefac[a]&&(o=s.scalefac[a]));for(r=0;r<16;r++)if(i<v[r]&&o<g[r]){var f=S[r]*_+M[r]*l;s.part2_length>f&&(s.part2_length=f,s.scalefac_compress=r)}}function u(e,t){for(var a=0;a<t;++a)if(e[a]<0)return!1;return!0}var b=null;this.qupvt=null,this.setModules=function(e){this.qupvt=e,b=e};var p=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],d=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(t,a,s){var n=a.l3_enc,r=Math.min(576,a.max_nonzero_coeff+2>>1<<1);for(null!=s&&(s.sfb_count1=0);r>1&&0==(n[r-1]|n[r-2]);r-=2);a.count1=r;for(var i=0,_=0;r>3;r-=4){var o;if((2147483647&(n[r-1]|n[r-2]|n[r-3]|n[r-4]))>1)break;o=2*(2*(2*n[r-4]+n[r-3])+n[r-2])+n[r-1],i+=je.t32l[o],_+=je.t33l[o]}var f=i;if(a.count1table_select=0,i>_&&(f=_,a.count1table_select=1),a.count1bits=f,a.big_values=r,0==r)return f;if(a.block_type==K.SHORT_TYPE)(i=3*t.scalefac_band.s[3])>a.big_values&&(i=a.big_values),_=a.big_values;else if(a.block_type==K.NORM_TYPE){if(at(r<=576),i=a.region0_count=t.bv_scf[r-2],_=a.region1_count=t.bv_scf[r-1],at(i+_+2<K.SBPSY_l),_=t.scalefac_band.l[i+_+2],i=t.scalefac_band.l[i+1],_<r){c=new e(f);a.table_select[2]=l(n,_,r,c),f=c.bits}}else a.region0_count=7,a.region1_count=K.SBMAX_l-1-7-1,(i=t.scalefac_band.l[8])>(_=r)&&(i=_);if(i=Math.min(i,r),_=Math.min(_,r),at(i>=0),at(_>=0),0<i){c=new e(f);a.table_select[0]=l(n,0,i,c),f=c.bits}if(i<_){var c=new e(f);a.table_select[1]=l(n,i,_,c),f=c.bits}if(2==t.use_best_huffman&&(a.part2_3_length=f,best_huffman_divide(t,a),f=a.part2_3_length),null!=s&&a.block_type==K.NORM_TYPE){for(var h=0;t.scalefac_band.l[h]<a.big_values;)h++;s.sfb_count1=h}return f},this.count_bits=function(e,t,a,n){var r=a.l3_enc,i=Je.IXMAX_VAL/b.IPOW20(a.global_gain);if(a.xrpow_max>i)return Je.LARGE_BITS;if(s(t,r,b.IPOW20(a.global_gain),a,n),0!=(2&e.substep_shaping))for(var _=0,o=a.global_gain+a.scalefac_scale,l=.634521682242439/b.IPOW20(o),f=0;f<a.sfbmax;f++){var c=a.width[f];if(at(c>=0),0==e.pseudohalf[f])_+=c;else{var h;for(h=_,_+=c;h<_;++h)r[h]=t[h]>=l?r[h]:0}}return this.noquant_count_bits(e,a,n)},this.best_huffman_divide=function(t,a){var s=new ue,n=a.l3_enc,r=tt(23),i=tt(23),_=tt(23),o=tt(23);if(a.block_type!=K.SHORT_TYPE||1!=t.mode_gr){s.assign(a),a.block_type==K.NORM_TYPE&&(f(t,a,n,r,i,_,o),c(t,s,a,n,r,i,_,o));var h=s.big_values;if(!(0==h||(n[h-2]|n[h-1])>1||(h=a.count1+2)>576)){s.assign(a),s.count1=h;var u=0,b=0;for(at(h<=576);h>s.big_values;h-=4){var m=2*(2*(2*n[h-4]+n[h-3])+n[h-2])+n[h-1];u+=je.t32l[m],b+=je.t33l[m]}if(s.big_values=h,s.count1table_select=0,u>b&&(u=b,s.count1table_select=1),s.count1bits=u,s.block_type==K.NORM_TYPE)c(t,s,a,n,r,i,_,o);else{if(s.part2_3_length=u,(u=t.scalefac_band.l[8])>h&&(u=h),u>0){p=new e(s.part2_3_length);s.table_select[0]=l(n,0,u,p),s.part2_3_length=p.bits}if(h>u){var p=new e(s.part2_3_length);s.table_select[1]=l(n,u,h,p),s.part2_3_length=p.bits}a.part2_3_length>s.part2_3_length&&a.assign(s)}}}};var v=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],g=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],S=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],M=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];m.slen1_tab=S,m.slen2_tab=M,this.best_scalefac_store=function(e,t,a,s){var n,r,i,_,o=s.tt[t][a],l=0;for(i=0,n=0;n<o.sfbmax;n++){var f=o.width[n];for(at(f>=0),i+=f,_=-f;_<0&&0==o.l3_enc[_+i];_++);0==_&&(o.scalefac[n]=l=-2)}if(0==o.scalefac_scale&&0==o.preflag){var c=0;for(n=0;n<o.sfbmax;n++)o.scalefac[n]>0&&(c|=o.scalefac[n]);if(0==(1&c)&&0!=c){for(n=0;n<o.sfbmax;n++)o.scalefac[n]>0&&(o.scalefac[n]>>=1);o.scalefac_scale=l=1}}if(0==o.preflag&&o.block_type!=K.SHORT_TYPE&&2==e.mode_gr){for(n=11;n<K.SBPSY_l&&!(o.scalefac[n]<b.pretab[n]&&-2!=o.scalefac[n]);n++);if(n==K.SBPSY_l){for(n=11;n<K.SBPSY_l;n++)o.scalefac[n]>0&&(o.scalefac[n]-=b.pretab[n]);o.preflag=l=1}}for(r=0;r<4;r++)s.scfsi[a][r]=0;for(2==e.mode_gr&&1==t&&s.tt[0][a].block_type!=K.SHORT_TYPE&&s.tt[1][a].block_type!=K.SHORT_TYPE&&(h(a,s),l=0),n=0;n<o.sfbmax;n++)-2==o.scalefac[n]&&(o.scalefac[n]=0);0!=l&&(2==e.mode_gr?this.scale_bitcount(o):this.scale_bitcount_lsf(e,o))};var R=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],A=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],B=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,a,s,n=0,r=0,i=e.scalefac;if(at(u(i,e.sfbmax)),e.block_type==K.SHORT_TYPE)s=R,0!=e.mixed_block_flag&&(s=A);else if(s=B,0==e.preflag){for(a=11;a<K.SBPSY_l&&!(i[a]<b.pretab[a]);a++);if(a==K.SBPSY_l)for(e.preflag=1,a=11;a<K.SBPSY_l;a++)i[a]-=b.pretab[a]}for(a=0;a<e.sfbdivide;a++)n<i[a]&&(n=i[a]);for(;a<e.sfbmax;a++)r<i[a]&&(r=i[a]);for(e.part2_length=Je.LARGE_BITS,t=0;t<16;t++)n<v[t]&&r<g[t]&&e.part2_length>s[t]&&(e.part2_length=s[t],e.scalefac_compress=t);return e.part2_length==Je.LARGE_BITS};var w=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,t){var a,s,n,r,i,_,o,l,f=tt(4),c=t.scalefac;for(a=0!=t.preflag?2:0,o=0;o<4;o++)f[o]=0;if(t.block_type==K.SHORT_TYPE){s=1;h=b.nr_of_sfb_block[a][s];for(l=0,n=0;n<4;n++)for(r=h[n]/3,o=0;o<r;o++,l++)for(i=0;i<3;i++)c[3*l+i]>f[n]&&(f[n]=c[3*l+i])}else{s=0;var h=b.nr_of_sfb_block[a][s];for(l=0,n=0;n<4;n++)for(r=h[n],o=0;o<r;o++,l++)c[l]>f[n]&&(f[n]=c[l])}for(_=!1,n=0;n<4;n++)f[n]>w[a][n]&&(_=!0);if(!_){var u,m,p,d;for(t.sfb_partition_table=b.nr_of_sfb_block[a][s],n=0;n<4;n++)t.slen[n]=E[f[n]];switch(u=t.slen[0],m=t.slen[1],p=t.slen[2],d=t.slen[3],a){case 0:t.scalefac_compress=(5*u+m<<4)+(p<<2)+d;break;case 1:t.scalefac_compress=400+(5*u+m<<2)+p;break;case 2:t.scalefac_compress=500+3*u+m;break;default:$e.err.printf("intensity stereo not implemented yet\n")}}if(!_)for(at(null!=t.sfb_partition_table),t.part2_length=0,n=0;n<4;n++)t.part2_length+=t.slen[n]*t.sfb_partition_table[n];return _};var E=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var a,s=0;e.scalefac_band.l[++s]<t;);for(a=p[s][0];e.scalefac_band.l[a+1]>t;)a--;for(a<0&&(a=p[s][0]),e.bv_scf[t-2]=a,a=p[s][1];e.scalefac_band.l[a+e.bv_scf[t-2]+2]>t;)a--;a<0&&(a=p[s][1]),e.bv_scf[t-1]=a}}}function p(){function e(e){nt.arraycopy(e.header[e.w_ptr].buf,0,M,A,e.sideinfo_len),A+=e.sideinfo_len,R+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&xe.MAX_HEADER_BUF-1}function t(t,a,s){for(lt(s<p-2);s>0;){var n;0==B&&(B=8,lt(++A<Lame.LAME_MAXMP3BUFFER),lt(t.header[t.w_ptr].write_timing>=R),t.header[t.w_ptr].write_timing==R&&e(t),M[A]=0),n=Math.min(s,B),B-=n,lt((s-=n)<p),lt(B<p),M[A]|=a>>s<<B,R+=n}}function a(e,t,a){for(lt(a<p-2);a>0;){var s;0==B&&(B=8,lt(++A<Lame.LAME_MAXMP3BUFFER),M[A]=0),s=Math.min(a,B),B-=s,lt((a-=s)<p),lt(B<p),M[A]|=t>>a<<B,R+=s}}function s(e,a){var s,n=e.internal_flags;if(lt(a>=0),a>=8&&(t(n,76,8),a-=8),a>=8&&(t(n,65,8),a-=8),a>=8&&(t(n,77,8),a-=8),a>=8&&(t(n,69,8),a-=8),a>=32){var r=g.getLameShortVersion();if(a>=32)for(s=0;s<r.length&&a>=8;++s)a-=8,t(n,r.charAt(s),8)}for(;a>=1;a-=1)t(n,n.ancillary_flag,1),n.ancillary_flag^=e.disable_reservoir?0:1;lt(0==a)}function n(e,t,a){for(var s=e.header[e.h_ptr].ptr;a>0;){var n=Math.min(a,8-(7&s));lt((a-=n)<p),e.header[e.h_ptr].buf[s>>3]|=t>>a<<8-(7&s)-n,s+=n}e.header[e.h_ptr].ptr=s}function r(e,t){e<<=8;for(var a=0;a<8;a++)0!=(65536&((t<<=1)^(e<<=1)))&&(t^=m);return t}function i(e,t){var a,s,r,i=e.internal_flags;if(a=i.l3_side,i.header[i.h_ptr].ptr=0,rt.fill(i.header[i.h_ptr].buf,0,i.sideinfo_len,0),e.out_samplerate<16e3?n(i,4094,12):n(i,4095,12),n(i,e.version,1),n(i,1,2),n(i,e.error_protection?0:1,1),n(i,i.bitrate_index,4),n(i,i.samplerate_index,2),n(i,i.padding,1),n(i,e.extension,1),n(i,e.mode.ordinal(),2),n(i,i.mode_ext,2),n(i,e.copyright,1),n(i,e.original,1),n(i,e.emphasis,2),e.error_protection&&n(i,0,16),1==e.version){for(lt(a.main_data_begin>=0),n(i,a.main_data_begin,9),2==i.channels_out?n(i,a.private_bits,3):n(i,a.private_bits,5),r=0;r<i.channels_out;r++){var _;for(_=0;_<4;_++)n(i,a.scfsi[r][_],1)}for(s=0;s<2;s++)for(r=0;r<i.channels_out;r++)n(i,(o=a.tt[s][r]).part2_3_length+o.part2_length,12),n(i,o.big_values/2,9),n(i,o.global_gain,8),n(i,o.scalefac_compress,4),o.block_type!=K.NORM_TYPE?(n(i,1,1),n(i,o.block_type,2),n(i,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),n(i,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),n(i,o.table_select[1],5),n(i,o.subblock_gain[0],3),n(i,o.subblock_gain[1],3),n(i,o.subblock_gain[2],3)):(n(i,0,1),14==o.table_select[0]&&(o.table_select[0]=16),n(i,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),n(i,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),n(i,o.table_select[2],5),lt(0<=o.region0_count&&o.region0_count<16),lt(0<=o.region1_count&&o.region1_count<8),n(i,o.region0_count,4),n(i,o.region1_count,3)),n(i,o.preflag,1),n(i,o.scalefac_scale,1),n(i,o.count1table_select,1)}else for(lt(a.main_data_begin>=0),n(i,a.main_data_begin,8),n(i,a.private_bits,i.channels_out),s=0,r=0;r<i.channels_out;r++){var o=a.tt[s][r];n(i,o.part2_3_length+o.part2_length,12),n(i,o.big_values/2,9),n(i,o.global_gain,8),n(i,o.scalefac_compress,9),o.block_type!=K.NORM_TYPE?(n(i,1,1),n(i,o.block_type,2),n(i,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),n(i,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),n(i,o.table_select[1],5),n(i,o.subblock_gain[0],3),n(i,o.subblock_gain[1],3),n(i,o.subblock_gain[2],3)):(n(i,0,1),14==o.table_select[0]&&(o.table_select[0]=16),n(i,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),n(i,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),n(i,o.table_select[2],5),lt(0<=o.region0_count&&o.region0_count<16),lt(0<=o.region1_count&&o.region1_count<8),n(i,o.region0_count,4),n(i,o.region1_count,3)),n(i,o.scalefac_scale,1),n(i,o.count1table_select,1)}e.error_protection&&CRC_writeheader(i,i.header[i.h_ptr].buf);var l=i.h_ptr;lt(i.header[l].ptr==8*i.sideinfo_len),i.h_ptr=l+1&xe.MAX_HEADER_BUF-1,i.header[i.h_ptr].write_timing=i.header[l].write_timing+t,i.h_ptr==i.w_ptr&&nt.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}function _(e,a){var s,n=je.ht[a.count1table_select+32],r=0,i=a.big_values,_=a.big_values;for(lt(a.count1table_select<2),s=(a.count1-a.big_values)/4;s>0;--s){var o,l=0,f=0;0!=(o=a.l3_enc[i+0])&&(f+=8,a.xr[_+0]<0&&l++,lt(o<=1)),0!=(o=a.l3_enc[i+1])&&(f+=4,l*=2,a.xr[_+1]<0&&l++,lt(o<=1)),0!=(o=a.l3_enc[i+2])&&(f+=2,l*=2,a.xr[_+2]<0&&l++,lt(o<=1)),0!=(o=a.l3_enc[i+3])&&(f++,l*=2,a.xr[_+3]<0&&l++,lt(o<=1)),i+=4,_+=4,t(e,l+n.table[f],n.hlen[f]),r+=n.hlen[f]}return r}function o(e,a,s,n,r){var i=je.ht[a],_=0;if(lt(a<32),0==a)return _;for(var o=s;o<n;o+=2){var l=0,f=0,c=i.xlen,h=i.xlen,u=0,b=r.l3_enc[o],m=r.l3_enc[o+1];if(0!=b&&(r.xr[o]<0&&u++,l--),a>15){if(b>14){var d=b-15;lt(d<=i.linmax),u|=d<<1,f=c,b=15}if(m>14){var v=m-15;lt(v<=i.linmax),u<<=c,u|=v,f+=c,m=15}h=16}0!=m&&(u<<=1,r.xr[o+1]<0&&u++,l--),lt((b|m)<16),b=b*h+m,f-=l,l+=i.hlen[b],lt(l<=p),lt(f<=p),t(e,i.table[b],l),t(e,u,f),_+=l+f}return _}function l(e,t){var a=3*e.scalefac_band.s[3];a>t.big_values&&(a=t.big_values);var s=o(e,t.table_select[0],0,a,t);return s+=o(e,t.table_select[1],a,t.big_values,t)}function f(e,t){var a,s,n,r;a=t.big_values,lt(0<=a&&a<=576);var i=t.region0_count+1;return lt(0<=i),lt(i<e.scalefac_band.l.length),n=e.scalefac_band.l[i],i+=t.region1_count+1,lt(0<=i),lt(i<e.scalefac_band.l.length),r=e.scalefac_band.l[i],n>a&&(n=a),r>a&&(r=a),s=o(e,t.table_select[0],0,n,t),s+=o(e,t.table_select[1],n,r,t),s+=o(e,t.table_select[2],r,a,t)}function c(e){var a,s,n,r,i=0,o=e.internal_flags,c=o.l3_side;if(1==e.version)for(a=0;a<2;a++)for(s=0;s<o.channels_out;s++){var h=c.tt[a][s],u=st.slen1_tab[h.scalefac_compress],b=st.slen2_tab[h.scalefac_compress];for(r=0,n=0;n<h.sfbdivide;n++)-1!=h.scalefac[n]&&(t(o,h.scalefac[n],u),r+=u);for(;n<h.sfbmax;n++)-1!=h.scalefac[n]&&(t(o,h.scalefac[n],b),r+=b);lt(r==h.part2_length),h.block_type==K.SHORT_TYPE?r+=l(o,h):r+=f(o,h),r+=_(o,h),lt(r==h.part2_3_length+h.part2_length),i+=r}else for(a=0,s=0;s<o.channels_out;s++){var m,p,h=c.tt[a][s],d=0;if(lt(null!=h.sfb_partition_table),r=0,n=0,p=0,h.block_type==K.SHORT_TYPE){for(;p<4;p++){var v=h.sfb_partition_table[p]/3,g=h.slen[p];for(m=0;m<v;m++,n++)t(o,Math.max(h.scalefac[3*n+0],0),g),t(o,Math.max(h.scalefac[3*n+1],0),g),t(o,Math.max(h.scalefac[3*n+2],0),g),d+=3*g}r+=l(o,h)}else{for(;p<4;p++){var v=h.sfb_partition_table[p],g=h.slen[p];for(m=0;m<v;m++,n++)t(o,Math.max(h.scalefac[n],0),g),d+=g}r+=f(o,h)}r+=_(o,h),lt(r==h.part2_3_length),lt(d==h.part2_length),i+=d+r}return i}function h(){this.total=0}function u(e,t){var a,s,n,r,i,_=e.internal_flags;return i=_.w_ptr,-1==(r=_.h_ptr-1)&&(r=xe.MAX_HEADER_BUF-1),a=_.header[r].write_timing-R,t.total=a,a>=0&&(s=1+r-i,r<i&&(s=1+r-i+xe.MAX_HEADER_BUF),a-=8*s*_.sideinfo_len),n=b.getframebits(e),a+=n,t.total+=n,t.total%8!=0?t.total=1+t.total/8:t.total=t.total/8,t.total+=A+1,a<0&&nt.err.println("strange error flushing buffer ... \n"),a}var b=this,m=32773,p=32,d=null,v=null,g=null,S=null;this.setModules=function(e,t,a,s){d=e,v=t,g=a,S=s};var M=null,R=0,A=0,B=0;this.getframebits=function(e){var t,a=e.internal_flags;return t=0!=a.bitrate_index?je.bitrate_table[e.version][a.bitrate_index]:e.brate,lt(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+a.padding)},this.CRC_writeheader=function(e,t){var a=65535;a=r(255&t[2],a),a=r(255&t[3],a);for(var s=6;s<e.sideinfo_len;s++)a=r(255&t[s],a);t[4]=byte(a>>8),t[5]=byte(255&a)},this.flush_bitstream=function(e){var t,a,n=e.internal_flags,r=n.h_ptr-1;if(-1==r&&(r=xe.MAX_HEADER_BUF-1),t=n.l3_side,!((a=u(e,new h))<0)){if(s(e,a),lt(n.header[r].write_timing+this.getframebits(e)==R),n.ResvSize=0,t.main_data_begin=0,n.findReplayGain){var i=d.GetTitleGain(n.rgdata);lt(NEQ(i,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),n.RadioGain=0|Math.floor(10*i+.5)}n.findPeakSample&&(n.noclipGainChange=0|Math.ceil(20*Math.log10(n.PeakSample/32767)*10),n.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?n.noclipScale=Math.floor(32767/n.PeakSample*100)/100:n.noclipScale=-1)}},this.add_dummy_byte=function(e,t,s){for(var n,r=e.internal_flags;s-- >0;)for(a(0,t,8),n=0;n<xe.MAX_HEADER_BUF;++n)r.header[n].write_timing+=8},this.format_bitstream=function(e){var t,a=e.internal_flags;t=a.l3_side;var n=this.getframebits(e);s(e,t.resvDrain_pre),i(e,n);var r=8*a.sideinfo_len;if(r+=c(e),s(e,t.resvDrain_post),r+=t.resvDrain_post,t.main_data_begin+=(n-r)/8,u(e,new h)!=a.ResvSize&&nt.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=a.ResvSize&&(nt.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,a.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*a.sideinfo_len,r-t.resvDrain_post-8*a.sideinfo_len,r,r%8,n),nt.err.println("This is a fatal error.  It has several possible causes:"),nt.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),nt.err.println(" 9%%  Your system is overclocked"),nt.err.println(" 1%%  bug in LAME encoding library"),a.ResvSize=8*t.main_data_begin),lt(R%8==0),R>1e9){var _;for(_=0;_<xe.MAX_HEADER_BUF;++_)a.header[_].write_timing-=R;R=0}return 0},this.copy_buffer=function(e,t,a,s,n){var r=A+1;if(r<=0)return 0;if(0!=s&&r>s)return-1;if(nt.arraycopy(M,0,t,a,r),A=-1,B=0,0!=n){var i=ot(1);if(i[0]=e.nMusicCRC,S.updateMusicCRC(i,t,a,r),e.nMusicCRC=i[0],r>0&&(e.VBR_seek_table.nBytesWritten+=r),e.decode_on_the_fly)for(var _,o=_t([2,1152]),l=r,f=-1;0!=f;)if(f=v.hip_decode1_unclipped(e.hip,t,a,l,o[0],o[1]),l=0,-1==f&&(f=0),f>0){if(lt(f<=1152),e.findPeakSample){for(_=0;_<f;_++)o[0][_]>e.PeakSample?e.PeakSample=o[0][_]:-o[0][_]>e.PeakSample&&(e.PeakSample=-o[0][_]);if(e.channels_out>1)for(_=0;_<f;_++)o[1][_]>e.PeakSample?e.PeakSample=o[1][_]:-o[1][_]>e.PeakSample&&(e.PeakSample=-o[1][_])}if(e.findReplayGain&&d.AnalyzeSamples(e.rgdata,o[0],0,o[1],0,f,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return r},this.init_bit_stream_w=function(e){M=it(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,A=-1,B=0,R=0}}function d(){function e(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=bt(K.SBMAX_l),this.bo_s_weight=bt(K.SBMAX_s)}function t(){this.lowerlimit=0}function a(e,t){this.lowpass=t}function s(e){var t;return e.class_id=V,t=e.internal_flags=new xe,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=ht.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=K.ENCDELAY+K.POSTDELAY,e.encoder_padding=0,t.mf_size=K.ENCDELAY-K.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}function n(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function r(e,t){var a=44100;return t>=48e3?a=48e3:t>=44100?a=44100:t>=32e3?a=32e3:t>=24e3?a=24e3:t>=22050?a=22050:t>=16e3?a=16e3:t>=12e3?a=12e3:t>=11025?a=11025:t>=8e3&&(a=8e3),-1==e?a:(e<=15960&&(a=44100),e<=15250&&(a=32e3),e<=11220&&(a=24e3),e<=9970&&(a=22050),e<=7230&&(a=16e3),e<=5420&&(a=12e3),e<=4510&&(a=11025),e<=3970&&(a=8e3),t<a?t>44100?48e3:t>32e3?44100:t>24e3?32e3:t>22050?24e3:t>16e3?22050:t>12e3?16e3:t>11025?12e3:t>8e3?11025:8e3:a)}function i(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:return t.version=0,0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0,0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}function _(e,t,a){a<16e3&&(t=2);for(var s=je.bitrate_table[t][1],n=2;n<=14;n++)je.bitrate_table[t][n]>0&&Math.abs(je.bitrate_table[t][n]-e)<Math.abs(s-e)&&(s=je.bitrate_table[t][n]);return s}function o(e,t,a){a<16e3&&(t=2);for(var s=0;s<=14;s++)if(je.bitrate_table[t][s]>0&&je.bitrate_table[t][s]==e)return s;return-1}function l(e,t){var s=[new a(8,2e3),new a(16,3700),new a(24,3900),new a(32,5500),new a(40,7e3),new a(48,7500),new a(56,1e4),new a(64,11e3),new a(80,13500),new a(96,15100),new a(112,15600),new a(128,17e3),new a(160,17500),new a(192,18600),new a(224,19400),new a(256,19700),new a(320,20500)],n=B.nearestBitrateFullIndex(t);e.lowerlimit=s[n].lowpass}function f(e){var t=e.internal_flags,a=32,s=-1;if(t.lowpass1>0){for(var r=999,i=0;i<=31;i++)(f=i/31)>=t.lowpass2&&(a=Math.min(a,i)),t.lowpass1<f&&f<t.lowpass2&&(r=Math.min(r,i));t.lowpass1=999==r?(a-.75)/31:(r-.75)/31,t.lowpass2=a/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,ct.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){for(var _=-1,i=0;i<=31;i++)(f=i/31)<=t.highpass1&&(s=Math.max(s,i)),t.highpass1<f&&f<t.highpass2&&(_=Math.max(_,i));t.highpass1=s/31,t.highpass2=-1==_?(s+.75)/31:(_+.75)/31}for(i=0;i<32;i++){var o,l,f=i/31;o=t.highpass2>t.highpass1?n((t.highpass2-f)/(t.highpass2-t.highpass1+1e-20)):1,l=t.lowpass2>t.lowpass1?n((f-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[i]=o*l}}function c(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}function h(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&I.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=mt([16,5]),t.bitrate_blockType_Hist=mt([16,6]),t.PeakSample=0,e.bWriteVbrTag&&x.InitVbrTag(e)}function u(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=bt(t),e.in_buffer_1=bt(t),e.in_buffer_nsamples=t)}function b(e){var t=K.BLKSIZE+e.framesize-K.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),dt(xe.MFSIZE>=t),t}function m(e,t,a,s,n,r,i){var _,o,l,f,c,h=e.internal_flags,u=0,m=[null,null],d=[null,null];if(h.Class_ID!=V)return-3;if(0==s)return 0;if((c=E.copy_buffer(h,n,r,i,0))<0)return c;if(r+=c,u+=c,d[0]=t,d[1]=a,ft.NEQ(e.scale,0)&&ft.NEQ(e.scale,1))for(o=0;o<s;++o)d[0][o]*=e.scale,2==h.channels_out&&(d[1][o]*=e.scale);if(ft.NEQ(e.scale_left,0)&&ft.NEQ(e.scale_left,1))for(o=0;o<s;++o)d[0][o]*=e.scale_left;if(ft.NEQ(e.scale_right,0)&&ft.NEQ(e.scale_right,1))for(o=0;o<s;++o)d[1][o]*=e.scale_right;if(2==e.num_channels&&1==h.channels_out)for(o=0;o<s;++o)d[0][o]=.5*(d[0][o]+d[1][o]),d[1][o]=0;f=b(e),m[0]=h.mfbuf[0],m[1]=h.mfbuf[1];for(var g=0;s>0;){var S=[null,null],M=0,R=0;S[0]=d[0],S[1]=d[1];var B=new v;if(A(e,m,S,g,s,B),M=B.n_in,R=B.n_out,h.findReplayGain&&!h.decode_on_the_fly&&w.AnalyzeSamples(h.rgdata,m[0],h.mf_size,m[1],h.mf_size,R,h.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(s-=M,g+=M,h.channels_out,h.mf_size+=R,dt(h.mf_size<=xe.MFSIZE),h.mf_samples_to_encode<1&&(h.mf_samples_to_encode=K.ENCDELAY+K.POSTDELAY),h.mf_samples_to_encode+=R,h.mf_size>=f){var T=i-u;if(0==i&&(T=0),(_=p(e,m[0],m[1],n,r,T))<0)return _;for(r+=_,u+=_,h.mf_size-=e.framesize,h.mf_samples_to_encode-=e.framesize,l=0;l<h.channels_out;l++)for(o=0;o<h.mf_size;o++)m[l][o]=m[l][o+e.framesize]}}return dt(0==s),u}function p(e,t,a,s,n,r){var i=B.enc.lame_encode_mp3_frame(e,t,a,s,n,r);return e.frameNum++,i}function v(){this.n_in=0,this.n_out=0}function g(){this.num_used=0}function S(e,t){return 0!=t?S(t,e%t):e}function M(e,t,a){var s=Math.PI*t;(e/=a)<0&&(e=0),e>1&&(e=1);var n=e-.5,r=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(n)<1e-9?s/Math.PI:r*Math.sin(a*s*n)/(Math.PI*a*n)}function R(e,t,a,s,n,r,i,_,o){var l,f,c=e.internal_flags,h=0,u=e.out_samplerate/S(e.out_samplerate,e.in_samplerate);u>xe.BPC&&(u=xe.BPC);var b=Math.abs(c.resample_ratio-Math.floor(.5+c.resample_ratio))<1e-4?1:0,m=1/c.resample_ratio;m>1&&(m=1);var p=31;0==p%2&&--p;var d=(p+=b)+1;if(0==c.fill_buffer_resample_init){for(c.inbuf_old[0]=bt(d),c.inbuf_old[1]=bt(d),l=0;l<=2*u;++l)c.blackfilt[l]=bt(d);for(c.itime[0]=0,c.itime[1]=0,h=0;h<=2*u;h++){var v=0,g=(h-u)/(2*u);for(l=0;l<=p;l++)v+=c.blackfilt[h][l]=M(l-g,m,p);for(l=0;l<=p;l++)c.blackfilt[h][l]/=v}c.fill_buffer_resample_init=1}var R=c.inbuf_old[o];for(f=0;f<s;f++){var A,B;if(A=f*c.resample_ratio,h=0|Math.floor(A-c.itime[o]),p+h-p/2>=i)break;g=A-c.itime[o]-(h+p%2*.5);dt(Math.abs(g)<=.501),B=0|Math.floor(2*g*u+u+.5);var w=0;for(l=0;l<=p;++l){var E=l+h-p/2;dt(E<i),dt(E+d>=0),w+=(E<0?R[d+E]:n[r+E])*c.blackfilt[B][l]}t[a+f]=w}if(_.num_used=Math.min(i,p+h-p/2),c.itime[o]+=_.num_used-f*c.resample_ratio,_.num_used>=d)for(l=0;l<d;l++)R[l]=n[r+_.num_used+l-d];else{var T=d-_.num_used;for(l=0;l<T;++l)R[l]=R[l+_.num_used];for(h=0;l<d;++l,++h)R[l]=n[r+h];dt(h==_.num_used)}return f}function A(e,t,a,s,n,r){var i=e.internal_flags;if(i.resample_ratio<.9999||i.resample_ratio>1.0001)for(var _=0;_<i.channels_out;_++){var o=new g;r.n_out=R(e,t[_],i.mf_size,e.framesize,a[_],s,n,o,_),r.n_in=o.num_used}else{r.n_out=Math.min(e.framesize,n),r.n_in=r.n_out;for(var l=0;l<r.n_out;++l)t[0][i.mf_size+l]=a[0][s+l],2==i.channels_out&&(t[1][i.mf_size+l]=a[1][s+l])}}var B=this;d.V9=410,d.V8=420,d.V7=430,d.V6=440,d.V5=450,d.V4=460,d.V3=470,d.V2=480,d.V1=490,d.V0=500,d.R3MIX=1e3,d.STANDARD=1001,d.EXTREME=1002,d.INSANE=1003,d.STANDARD_FAST=1004,d.EXTREME_FAST=1005,d.MEDIUM=1006,d.MEDIUM_FAST=1007;d.LAME_MAXMP3BUFFER=147456;var w,E,T,y,k,x,P,I,L,H=new ie;this.enc=new K,this.setModules=function(e,t,a,s,n,r,i,_,o){w=e,E=t,T=a,y=s,k=n,x=r,P=i,I=_,L=o,this.enc.setModules(E,H,y,x)};var V=4294479419;this.lame_init=function(){var e=new oe;return 0!=s(e)?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],a=0,s=0,n=0,r=0;r=t[16],n=16,s=t[16],a=16;for(var i=0;i<16;i++)if(Math.max(e,t[i+1])!=e){r=t[i+1],n=i+1,s=t[i],a=i;break}return r-e>e-s?a:n},this.lame_init_params=function(a){var s=a.internal_flags;if(s.Class_ID=0,null==s.ATH&&(s.ATH=new Ie),null==s.PSY&&(s.PSY=new e),null==s.rgdata&&(s.rgdata=new Xe),s.channels_in=a.num_channels,1==s.channels_in&&(a.mode=MPEGMode.MONO),s.channels_out=a.mode==MPEGMode.MONO?1:2,s.mode_ext=K.MPG_MD_MS_LR,a.mode==MPEGMode.MONO&&(a.force_ms=!1),a.VBR==ht.vbr_off&&128!=a.VBR_mean_bitrate_kbps&&0==a.brate&&(a.brate=a.VBR_mean_bitrate_kbps),a.VBR==ht.vbr_off||a.VBR==ht.vbr_mtrh||a.VBR==ht.vbr_mt||(a.free_format=!1),a.VBR==ht.vbr_off&&0==a.brate&&ft.EQ(a.compression_ratio,0)&&(a.compression_ratio=11.025),a.VBR==ht.vbr_off&&a.compression_ratio>0&&(0==a.out_samplerate&&(a.out_samplerate=map2MP3Frequency(int(.97*a.in_samplerate))),a.brate=0|16*a.out_samplerate*s.channels_out/(1e3*a.compression_ratio),s.samplerate_index=i(a.out_samplerate,a),a.free_format||(a.brate=_(a.brate,a.version,a.out_samplerate))),0!=a.out_samplerate&&(a.out_samplerate<16e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,64)):a.out_samplerate<32e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,160)):(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,32),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,320))),0==a.lowpassfreq){var n=16e3;switch(a.VBR){case ht.vbr_off:l(u=new t,a.brate),n=u.lowerlimit;break;case ht.vbr_abr:var u=new t;l(u,a.VBR_mean_bitrate_kbps),n=u.lowerlimit;break;case ht.vbr_rh:d=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var b=d[a.VBR_q],m=d[a.VBR_q+1],p=a.VBR_q_frac;n=linear_int(b,m,p)}else n=19500;break;default:var d=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var b=d[a.VBR_q],m=d[a.VBR_q+1],p=a.VBR_q_frac;n=linear_int(b,m,p)}else n=19500}a.mode!=MPEGMode.MONO||a.VBR!=ht.vbr_off&&a.VBR!=ht.vbr_abr||(n*=1.5),a.lowpassfreq=0|n}if(0==a.out_samplerate&&(2*a.lowpassfreq>a.in_samplerate&&(a.lowpassfreq=a.in_samplerate/2),a.out_samplerate=r(0|a.lowpassfreq,a.in_samplerate)),a.lowpassfreq=Math.min(20500,a.lowpassfreq),a.lowpassfreq=Math.min(a.out_samplerate/2,a.lowpassfreq),a.VBR==ht.vbr_off&&(a.compression_ratio=16*a.out_samplerate*s.channels_out/(1e3*a.brate)),a.VBR==ht.vbr_abr&&(a.compression_ratio=16*a.out_samplerate*s.channels_out/(1e3*a.VBR_mean_bitrate_kbps)),a.bWriteVbrTag||(a.findReplayGain=!1,a.decode_on_the_fly=!1,s.findPeakSample=!1),s.findReplayGain=a.findReplayGain,s.decode_on_the_fly=a.decode_on_the_fly,s.decode_on_the_fly&&(s.findPeakSample=!0),s.findReplayGain&&w.InitGainAnalysis(s.rgdata,a.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return a.internal_flags=null,-6;switch(s.decode_on_the_fly&&!a.decode_only&&(null!=s.hip&&L.hip_decode_exit(s.hip),s.hip=L.hip_decode_init()),s.mode_gr=a.out_samplerate<=24e3?1:2,a.framesize=576*s.mode_gr,a.encoder_delay=K.ENCDELAY,s.resample_ratio=a.in_samplerate/a.out_samplerate,a.VBR){case ht.vbr_mt:case ht.vbr_rh:case ht.vbr_mtrh:var v=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];a.compression_ratio=v[a.VBR_q];break;case ht.vbr_abr:a.compression_ratio=16*a.out_samplerate*s.channels_out/(1e3*a.VBR_mean_bitrate_kbps);break;default:a.compression_ratio=16*a.out_samplerate*s.channels_out/(1e3*a.brate)}if(a.mode==MPEGMode.NOT_SET&&(a.mode=MPEGMode.JOINT_STEREO),a.highpassfreq>0?(s.highpass1=2*a.highpassfreq,a.highpasswidth>=0?s.highpass2=2*(a.highpassfreq+a.highpasswidth):s.highpass2=2*a.highpassfreq,s.highpass1/=a.out_samplerate,s.highpass2/=a.out_samplerate):(s.highpass1=0,s.highpass2=0),a.lowpassfreq>0?(s.lowpass2=2*a.lowpassfreq,a.lowpasswidth>=0?(s.lowpass1=2*(a.lowpassfreq-a.lowpasswidth),s.lowpass1<0&&(s.lowpass1=0)):s.lowpass1=2*a.lowpassfreq,s.lowpass1/=a.out_samplerate,s.lowpass2/=a.out_samplerate):(s.lowpass1=0,s.lowpass2=0),f(a),s.samplerate_index=i(a.out_samplerate,a),s.samplerate_index<0)return a.internal_flags=null,-1;if(a.VBR==ht.vbr_off){if(a.free_format)s.bitrate_index=0;else if(a.brate=_(a.brate,a.version,a.out_samplerate),s.bitrate_index=o(a.brate,a.version,a.out_samplerate),s.bitrate_index<=0)return a.internal_flags=null,-1}else s.bitrate_index=1;a.analysis&&(a.bWriteVbrTag=!1),null!=s.pinfo&&(a.bWriteVbrTag=!1),E.init_bit_stream_w(s);for(var g=s.samplerate_index+3*a.version+6*(a.out_samplerate<16e3?1:0),S=0;S<K.SBMAX_l+1;S++)s.scalefac_band.l[S]=y.sfBandIndex[g].l[S];for(S=0;S<K.PSFB21+1;S++){var M=(s.scalefac_band.l[22]-s.scalefac_band.l[21])/K.PSFB21,R=s.scalefac_band.l[21]+S*M;s.scalefac_band.psfb21[S]=R}s.scalefac_band.psfb21[K.PSFB21]=576;for(S=0;S<K.SBMAX_s+1;S++)s.scalefac_band.s[S]=y.sfBandIndex[g].s[S];for(S=0;S<K.PSFB12+1;S++){var M=(s.scalefac_band.s[13]-s.scalefac_band.s[12])/K.PSFB12,R=s.scalefac_band.s[12]+S*M;s.scalefac_band.psfb12[S]=R}s.scalefac_band.psfb12[K.PSFB12]=192,1==a.version?s.sideinfo_len=1==s.channels_out?21:36:s.sideinfo_len=1==s.channels_out?13:21,a.error_protection&&(s.sideinfo_len+=2),h(a),s.Class_ID=V;var A;for(A=0;A<19;A++)s.nsPsy.pefirbuf[A]=700*s.mode_gr*s.channels_out;switch(-1==a.ATHtype&&(a.ATHtype=4),dt(a.VBR_q<=9),dt(a.VBR_q>=0),a.VBR){case ht.vbr_mt:a.VBR=ht.vbr_mtrh;case ht.vbr_mtrh:null==a.useTemporal&&(a.useTemporal=!1),T.apply_preset(a,500-10*a.VBR_q,0),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),a.quality<5&&(a.quality=0),a.quality>5&&(a.quality=5),s.PSY.mask_adjust=a.maskingadjust,s.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?s.sfb21_extra=!1:s.sfb21_extra=a.out_samplerate>44e3,s.iteration_loop=new VBRNewIterationLoop(k);break;case ht.vbr_rh:T.apply_preset(a,500-10*a.VBR_q,0),s.PSY.mask_adjust=a.maskingadjust,s.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?s.sfb21_extra=!1:s.sfb21_extra=a.out_samplerate>44e3,a.quality>6&&(a.quality=6),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),s.iteration_loop=new VBROldIterationLoop(k);break;default:var B;s.sfb21_extra=!1,a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),(B=a.VBR)==ht.vbr_off&&(a.VBR_mean_bitrate_kbps=a.brate),T.apply_preset(a,a.VBR_mean_bitrate_kbps,0),a.VBR=B,s.PSY.mask_adjust=a.maskingadjust,s.PSY.mask_adjust_short=a.maskingadjust_short,B==ht.vbr_off?s.iteration_loop=new Ce(k):s.iteration_loop=new ABRIterationLoop(k)}if(dt(a.scale>=0),a.VBR!=ht.vbr_off){if(s.VBR_min_bitrate=1,s.VBR_max_bitrate=14,a.out_samplerate<16e3&&(s.VBR_max_bitrate=8),0!=a.VBR_min_bitrate_kbps&&(a.VBR_min_bitrate_kbps=_(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),s.VBR_min_bitrate=o(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),s.VBR_min_bitrate<0))return-1;if(0!=a.VBR_max_bitrate_kbps&&(a.VBR_max_bitrate_kbps=_(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),s.VBR_max_bitrate=o(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),s.VBR_max_bitrate<0))return-1;a.VBR_min_bitrate_kbps=je.bitrate_table[a.version][s.VBR_min_bitrate],a.VBR_max_bitrate_kbps=je.bitrate_table[a.version][s.VBR_max_bitrate],a.VBR_mean_bitrate_kbps=Math.min(je.bitrate_table[a.version][s.VBR_max_bitrate],a.VBR_mean_bitrate_kbps),a.VBR_mean_bitrate_kbps=Math.max(je.bitrate_table[a.version][s.VBR_min_bitrate],a.VBR_mean_bitrate_kbps)}return a.tune&&(s.PSY.mask_adjust+=a.tune_value_a,s.PSY.mask_adjust_short+=a.tune_value_a),c(a),dt(a.scale>=0),a.athaa_type<0?s.ATH.useAdjust=3:s.ATH.useAdjust=a.athaa_type,s.ATH.aaSensitivityP=Math.pow(10,a.athaa_sensitivity/-10),null==a.short_blocks&&(a.short_blocks=ut.short_block_allowed),a.short_blocks!=ut.short_block_allowed||a.mode!=MPEGMode.JOINT_STEREO&&a.mode!=MPEGMode.STEREO||(a.short_blocks=ut.short_block_coupled),a.quant_comp<0&&(a.quant_comp=1),a.quant_comp_short<0&&(a.quant_comp_short=0),a.msfix<0&&(a.msfix=0),a.exp_nspsytune=1|a.exp_nspsytune,a.internal_flags.nsPsy.attackthre<0&&(a.internal_flags.nsPsy.attackthre=ie.NSATTACKTHRE),a.internal_flags.nsPsy.attackthre_s<0&&(a.internal_flags.nsPsy.attackthre_s=ie.NSATTACKTHRE_S),dt(a.scale>=0),a.scale<0&&(a.scale=1),a.ATHtype<0&&(a.ATHtype=4),a.ATHcurve<0&&(a.ATHcurve=4),a.athaa_loudapprox<0&&(a.athaa_loudapprox=2),a.interChRatio<0&&(a.interChRatio=0),null==a.useTemporal&&(a.useTemporal=!0),s.slot_lag=s.frac_SpF=0,a.VBR==ht.vbr_off&&(s.slot_lag=s.frac_SpF=72e3*(a.version+1)*a.brate%a.out_samplerate|0),y.iteration_init(a),H.psymodel_init(a),dt(a.scale>=0),0},this.lame_encode_flush=function(e,t,a,s){var n,r,i,_,o=e.internal_flags,l=pt([2,1152]),f=0,c=o.mf_samples_to_encode-K.POSTDELAY,h=b(e);if(o.mf_samples_to_encode<1)return 0;for(n=0,e.in_samplerate!=e.out_samplerate&&(c+=16*e.out_samplerate/e.in_samplerate),(i=e.framesize-c%e.framesize)<576&&(i+=e.framesize),e.encoder_padding=i,_=(c+i)/e.framesize;_>0&&f>=0;){var u=h-o.mf_size,m=e.frameNum;u*=e.in_samplerate,(u/=e.out_samplerate)>1152&&(u=1152),u<1&&(u=1),r=s-n,0==s&&(r=0),a+=f=this.lame_encode_buffer(e,l[0],l[1],u,t,a,r),n+=f,_-=m!=e.frameNum?1:0}if(o.mf_samples_to_encode=0,f<0)return f;if(r=s-n,0==s&&(r=0),E.flush_bitstream(e),(f=E.copy_buffer(o,t,a,r,1))<0)return f;if(a+=f,n+=f,r=s-n,0==s&&(r=0),e.write_id3tag_automatic){if(I.id3tag_write_v1(e),(f=E.copy_buffer(o,t,a,r,0))<0)return f;n+=f}return n},this.lame_encode_buffer=function(e,t,a,s,n,r,i){var _=e.internal_flags,o=[null,null];if(_.Class_ID!=V)return-3;if(0==s)return 0;u(_,s),o[0]=_.in_buffer_0,o[1]=_.in_buffer_1;for(var l=0;l<s;l++)o[0][l]=t[l],_.channels_in>1&&(o[1][l]=a[l]);return m(e,o[0],o[1],s,n,r,i)}}function v(){function e(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var a=1;a<e.size;a+=2)e.bag[a/2]=e.bag[a];e.want*=2,e.pos/=2}}function t(e,t){if(!(e.pos<=0))for(var a=1;a<b;++a){var s,n,r=a/b,i=0|Math.floor(r*e.pos);i>e.pos-1&&(i=e.pos-1);var _=0|256*(s=e.bag[i])/(n=e.sum);_>255&&(_=255),t[a]=255&_}}function a(e,t){var a=255&e[t+0];return a<<=8,a|=255&e[t+1],a<<=8,a|=255&e[t+2],a<<=8,a|=255&e[t+3]}function s(e,t,a){e[t+0]=255&a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a}function n(e,t,a){e[t+0]=255&a>>8,e[t+1]=255&a}function r(e,t){return new String(e,t,R.length(),M).equals(R)||new String(e,t,A.length(),M).equals(A)}function i(e,t,a){return 255&(e<<t|a&~(-1<<t))}function _(e,t){var a=e.internal_flags;t[0]=i(t[0],8,255),t[1]=i(t[1],3,7),t[1]=i(t[1],1,e.out_samplerate<16e3?0:1),t[1]=i(t[1],1,e.version),t[1]=i(t[1],2,1),t[1]=i(t[1],1,e.error_protection?0:1),t[2]=i(t[2],4,a.bitrate_index),t[2]=i(t[2],2,a.samplerate_index),t[2]=i(t[2],1,0),t[2]=i(t[2],1,e.extension),t[3]=i(t[3],2,e.mode.ordinal()),t[3]=i(t[3],2,a.mode_ext),t[3]=i(t[3],1,e.copyright),t[3]=i(t[3],1,e.original),t[3]=i(t[3],2,e.emphasis),t[0]=255;var s,n=241&t[1];s=1==e.version?d:e.out_samplerate<16e3?S:g,e.VBR==Ht.vbr_off&&(s=e.brate);var r;r=e.free_format?0:255&16*c.BitrateIndex(s,e.version,e.out_samplerate),1==e.version?(t[1]=255&(10|n),n=13&t[2],t[2]=255&(r|n)):(t[1]=255&(2|n),n=13&t[2],t[2]=255&(r|n))}function o(e,t){return t=t>>8^B[255&(t^e)]}function l(e,t,a,r,i){var _,l,f,c=e.internal_flags,h=0,b=e.encoder_delay,m=e.encoder_padding,p=100-10*e.VBR_q-e.quality,d=u.getLameVeryShortVersion(),v=[1,5,3,2,4,0,3],g=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),S=0,M=0,R=e.internal_flags.noise_shaping,A=0,B=0,w=0,E=0,T=0,y=0!=(1&e.exp_nspsytune),k=0!=(2&e.exp_nspsytune),x=!1,P=!1,I=e.internal_flags.nogap_total,L=e.internal_flags.nogap_current,H=e.ATHtype,V=0;switch(e.VBR){case vbr_abr:f=e.VBR_mean_bitrate_kbps;break;case vbr_off:f=e.brate;break;default:f=e.VBR_min_bitrate_kbps}switch(_=e.VBR.ordinal()<v.length?v[e.VBR.ordinal()]:0,l=0+_,c.findReplayGain&&(c.RadioGain>510&&(c.RadioGain=510),c.RadioGain<-510&&(c.RadioGain=-510),M=8192,M|=3072,c.RadioGain>=0?M|=c.RadioGain:(M|=512,M|=-c.RadioGain)),c.findPeakSample&&(S=Math.abs(0|c.PeakSample/32767*Math.pow(2,23)+.5)),-1!=I&&(L>0&&(P=!0),L<I-1&&(x=!0)),V=H+((y?1:0)<<4)+((k?1:0)<<5)+((x?1:0)<<6)+((P?1:0)<<7),p<0&&(p=0),e.mode){case MONO:A=0;break;case STEREO:A=1;break;case DUAL_CHANNEL:A=2;break;case JOINT_STEREO:A=e.force_ms?4:3;break;case NOT_SET:default:A=7}w=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==Vt.short_block_forced||e.short_blocks==Vt.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==H||e.in_samplerate<=32e3)&&(B=1),E=R+(A<<2)+(B<<5)+(w<<6),T=c.nMusicCRC,s(a,r+h,p),h+=4;for(var N=0;N<9;N++)a[r+h+N]=255&d.charAt(N);a[r+(h+=9)]=255&l,a[r+ ++h]=255&g,s(a,r+ ++h,S),n(a,r+(h+=4),M),n(a,r+(h+=2),0),a[r+(h+=2)]=255&V,a[r+ ++h]=f>=255?255:255&f,a[r+ ++h]=255&b>>4,a[r+h+1]=255&(b<<4)+(m>>8),a[r+h+2]=255&m,a[r+(h+=3)]=255&E,h++,a[r+h++]=0,n(a,r+h,e.preset),s(a,r+(h+=2),t),n(a,r+(h+=4),T),h+=2;for(var O=0;O<h;O++)i=o(a[r+O],i);return n(a,r+h,i),h+=2}function f(e){e.seek(0);var t=Ot(10);e.readFully(t);return new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}var c,h,u;this.setModules=function(e,t,a){c=e,h=t,u=a};var b=v.NUMTOCENTRIES,m=v.MAXFRAMESIZE,p=b+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,d=128,g=64,S=32,M=null,R="Xing",A="Info",B=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.addVbrFrame=function(t){var a=t.internal_flags,s=Tables.bitrate_table[t.version][a.bitrate_index];Xt(null!=a.VBR_seek_table.bag),e(a.VBR_seek_table,s)},this.getVbrTag=function(e){var t=new VBRTagData,s=0;t.flags=0;var n=e[s+1]>>3&1,i=e[s+2]>>2&3,_=e[s+3]>>6&3,o=e[s+2]>>4&15;if(o=Tables.bitrate_table[n][o],e[s+1]>>4==14?t.samprate=Tables.samplerate_table[2][i]:t.samprate=Tables.samplerate_table[n][i],s+=0!=n?3!=_?36:21:3!=_?21:13,!r(e,s))return null;s+=4,t.hId=n;var l=t.flags=a(e,s);if(s+=4,0!=(1&l)&&(t.frames=a(e,s),s+=4),0!=(2&l)&&(t.bytes=a(e,s),s+=4),0!=(4&l)){if(null!=t.toc)for(var f=0;f<b;f++)t.toc[f]=e[s+f];s+=b}t.vbrScale=-1,0!=(8&l)&&(t.vbrScale=a(e,s),s+=4),t.headersize=72e3*(n+1)*o/t.samprate;var c=e[(s+=21)+0]<<4;c+=e[s+1]>>4;var h=(15&e[s+1])<<8;return h+=255&e[s+2],(c<0||c>3e3)&&(c=-1),(h<0||h>3e3)&&(h=-1),t.encDelay=c,t.encPadding=h,t},this.InitVbrTag=function(e){var t,a=e.internal_flags;t=1==e.version?d:e.out_samplerate<16e3?S:g,e.VBR==Ht.vbr_off&&(t=e.brate);var s=72e3*(e.version+1)*t/e.out_samplerate,n=a.sideinfo_len+p;if(a.VBR_seek_table.TotalFrameSize=s,s<n||s>m)e.bWriteVbrTag=!1;else{a.VBR_seek_table.nVbrNumFrames=0,a.VBR_seek_table.nBytesWritten=0,a.VBR_seek_table.sum=0,a.VBR_seek_table.seen=0,a.VBR_seek_table.want=1,a.VBR_seek_table.pos=0,null==a.VBR_seek_table.bag&&(a.VBR_seek_table.bag=new int[400],a.VBR_seek_table.size=400);var r=Ot(m);_(e,r);for(var i=a.VBR_seek_table.TotalFrameSize,o=0;o<i;++o)h.add_dummy_byte(e,255&r[o],1)}},this.updateMusicCRC=function(e,t,a,s){for(var n=0;n<s;++n)e[0]=o(t[a+n],e[0])},this.getLameTagFrame=function(e,a){var n=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(n.Class_ID!=Lame.LAME_ID)return 0;if(n.VBR_seek_table.pos<=0)return 0;if(a.length<n.VBR_seek_table.TotalFrameSize)return n.VBR_seek_table.TotalFrameSize;Nt.fill(a,0,n.VBR_seek_table.TotalFrameSize,0),_(e,a);var r=Ot(b);if(e.free_format)for(u=1;u<b;++u)r[u]=255&255*u/100;else t(n.VBR_seek_table,r);var i=n.sideinfo_len;e.error_protection&&(i-=2),e.VBR==Ht.vbr_off?(a[i++]=255&A.charAt(0),a[i++]=255&A.charAt(1),a[i++]=255&A.charAt(2),a[i++]=255&A.charAt(3)):(a[i++]=255&R.charAt(0),a[i++]=255&R.charAt(1),a[i++]=255&R.charAt(2),a[i++]=255&R.charAt(3)),s(a,i,15),s(a,i+=4,n.VBR_seek_table.nVbrNumFrames),i+=4;var f=n.VBR_seek_table.nBytesWritten+n.VBR_seek_table.TotalFrameSize;s(a,i,0|f),i+=4,Lt.arraycopy(r,0,a,i,r.length),i+=r.length,e.error_protection&&h.CRC_writeheader(n,a);for(var c=0,u=0;u<i;u++)c=o(a[u],c);return i+=l(e,f,a,i,c),n.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var a=f(t);t.seek(a);var s=Ot(m),n=getLameTagFrame(e,s);return n>s.length?-1:n<1?0:(t.write(s,0,n),0)}}function g(){var e,t;this.setModules=function(a,s){e=a,t=s}}function S(){var e,t,a;this.setModules=function(s,n,r){e=s,t=n,a=r}}function M(){}function R(){var e,t;this.setModules=function(a,s){e=a,t=s}}function A(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function B(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}var w={};w.fill=function(e,t,a,s){if(2==arguments.length)for(n=0;n<e.length;n++)e[n]=arguments[1];else for(var n=t;n<a;n++)e[n]=s};var E={};E.arraycopy=function(e,t,a,s,n){for(var r=t+n;t<r;)a[s++]=e[t++]};var T={};T.SQRT2=1.4142135623730951,T.FAST_LOG10=function(e){return Math.log10(e)},T.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},_.short_block_allowed=new _(0),_.short_block_coupled=new _(1),_.short_block_dispensed=new _(2),_.short_block_forced=new _(3);var y={};y.MAX_VALUE=3.4028235e38,o.vbr_off=new o(0),o.vbr_mt=new o(1),o.vbr_rh=new o(2),o.vbr_abr=new o(3),o.vbr_mtrh=new o(4),o.vbr_default=o.vbr_mtrh;var k={System:E,VbrMode:o,Float:y,ShortBlock:_,Util:T,Arrays:w,new_array_n:i,new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:a,new_float_n:s,new_int:t,new_int_n:n,new_short:e,new_short_n:r,assert:function(e){}},x=k.System,P=k.Util,I=k.Arrays,L=k.new_float,H=function(){function e(e,t,a){for(var n=10,r=t+238-14-286,i=-15;i<0;i++){var _;_=s[n+-10],o=e[r+-224]*_,l=e[t+224]*_,_=s[n+-9],o+=e[r+-160]*_,l+=e[t+160]*_,_=s[n+-8],o+=e[r+-96]*_,l+=e[t+96]*_,_=s[n+-7],o+=e[r+-32]*_,l+=e[t+32]*_,_=s[n+-6],o+=e[r+32]*_,l+=e[t+-32]*_,_=s[n+-5],o+=e[r+96]*_,l+=e[t+-96]*_,_=s[n+-4],o+=e[r+160]*_,l+=e[t+-160]*_,_=s[n+-3],o+=e[r+224]*_,l+=e[t+-224]*_,_=s[n+-2],o+=e[t+-256]*_,l-=e[r+256]*_,_=s[n+-1],o+=e[t+-192]*_,l-=e[r+192]*_,_=s[n+0],o+=e[t+-128]*_,l-=e[r+128]*_,_=s[n+1],o+=e[t+-64]*_,l-=e[r+64]*_,_=s[n+2],o+=e[t+0]*_,l-=e[r+0]*_,_=s[n+3],o+=e[t+64]*_,l-=e[r+-64]*_,_=s[n+4],o+=e[t+128]*_,l-=e[r+-128]*_,_=s[n+5],o+=e[t+192]*_,_=(l-=e[r+-192]*_)-(o*=s[n+6]),a[30+2*i]=l+o,a[31+2*i]=s[n+7]*_,n+=18,t--,r++}var o,l,f,c;l=e[t+-16]*s[n+-10],o=e[t+-32]*s[n+-2],l+=(e[t+-48]-e[t+16])*s[n+-9],o+=e[t+-96]*s[n+-1],l+=(e[t+-80]+e[t+48])*s[n+-8],o+=e[t+-160]*s[n+0],l+=(e[t+-112]-e[t+80])*s[n+-7],o+=e[t+-224]*s[n+1],l+=(e[t+-144]+e[t+112])*s[n+-6],o-=e[t+32]*s[n+2],l+=(e[t+-176]-e[t+144])*s[n+-5],o-=e[t+96]*s[n+3],l+=(e[t+-208]+e[t+176])*s[n+-4],o-=e[t+160]*s[n+4],l+=(e[t+-240]-e[t+208])*s[n+-3],f=(o-=e[t+224])-l,c=o+l,l=a[14],o=a[15]-l,a[31]=c+l,a[30]=f+o,a[15]=f-o,a[14]=c-l;var h;h=a[28]-a[0],a[0]+=a[28],a[28]=h*s[n+-36+7],h=a[29]-a[1],a[1]+=a[29],a[29]=h*s[n+-36+7],h=a[26]-a[2],a[2]+=a[26],a[26]=h*s[n+-72+7],h=a[27]-a[3],a[3]+=a[27],a[27]=h*s[n+-72+7],h=a[24]-a[4],a[4]+=a[24],a[24]=h*s[n+-108+7],h=a[25]-a[5],a[5]+=a[25],a[25]=h*s[n+-108+7],h=a[22]-a[6],a[6]+=a[22],a[22]=h*P.SQRT2,h=a[23]-a[7],a[7]+=a[23],a[23]=h*P.SQRT2-a[7],a[7]-=a[6],a[22]-=a[7],a[23]-=a[22],h=a[6],a[6]=a[31]-h,a[31]=a[31]+h,h=a[7],a[7]=a[30]-h,a[30]=a[30]+h,h=a[22],a[22]=a[15]-h,a[15]=a[15]+h,h=a[23],a[23]=a[14]-h,a[14]=a[14]+h,h=a[20]-a[8],a[8]+=a[20],a[20]=h*s[n+-180+7],h=a[21]-a[9],a[9]+=a[21],a[21]=h*s[n+-180+7],h=a[18]-a[10],a[10]+=a[18],a[18]=h*s[n+-216+7],h=a[19]-a[11],a[11]+=a[19],a[19]=h*s[n+-216+7],h=a[16]-a[12],a[12]+=a[16],a[16]=h*s[n+-252+7],h=a[17]-a[13],a[13]+=a[17],a[17]=h*s[n+-252+7],h=-a[20]+a[24],a[20]+=a[24],a[24]=h*s[n+-216+7],h=-a[21]+a[25],a[21]+=a[25],a[25]=h*s[n+-216+7],h=a[4]-a[8],a[4]+=a[8],a[8]=h*s[n+-216+7],h=a[5]-a[9],a[5]+=a[9],a[9]=h*s[n+-216+7],h=a[0]-a[12],a[0]+=a[12],a[12]=h*s[n+-72+7],h=a[1]-a[13],a[1]+=a[13],a[13]=h*s[n+-72+7],h=a[16]-a[28],a[16]+=a[28],a[28]=h*s[n+-72+7],h=-a[17]+a[29],a[17]+=a[29],a[29]=h*s[n+-72+7],h=P.SQRT2*(a[2]-a[10]),a[2]+=a[10],a[10]=h,h=P.SQRT2*(a[3]-a[11]),a[3]+=a[11],a[11]=h,h=P.SQRT2*(-a[18]+a[26]),a[18]+=a[26],a[26]=h-a[18],h=P.SQRT2*(-a[19]+a[27]),a[19]+=a[27],a[27]=h-a[19],h=a[2],a[19]-=a[3],a[3]-=h,a[2]=a[31]-h,a[31]+=h,h=a[3],a[11]-=a[19],a[18]-=h,a[3]=a[30]-h,a[30]+=h,h=a[18],a[27]-=a[11],a[19]-=h,a[18]=a[15]-h,a[15]+=h,h=a[19],a[10]-=h,a[19]=a[14]-h,a[14]+=h,h=a[10],a[11]-=h,a[10]=a[23]-h,a[23]+=h,h=a[11],a[26]-=h,a[11]=a[22]-h,a[22]+=h,h=a[26],a[27]-=h,a[26]=a[7]-h,a[7]+=h,h=a[27],a[27]=a[6]-h,a[6]+=h,h=P.SQRT2*(a[0]-a[4]),a[0]+=a[4],a[4]=h,h=P.SQRT2*(a[1]-a[5]),a[1]+=a[5],a[5]=h,h=P.SQRT2*(a[16]-a[20]),a[16]+=a[20],a[20]=h,h=P.SQRT2*(a[17]-a[21]),a[17]+=a[21],a[21]=h,h=-P.SQRT2*(a[8]-a[12]),a[8]+=a[12],a[12]=h-a[8],h=-P.SQRT2*(a[9]-a[13]),a[9]+=a[13],a[13]=h-a[9],h=-P.SQRT2*(a[25]-a[29]),a[25]+=a[29],a[29]=h-a[25],h=-P.SQRT2*(a[24]+a[28]),a[24]-=a[28],a[28]=h-a[24],h=a[24]-a[16],a[24]=h,h=a[20]-h,a[20]=h,h=a[28]-h,a[28]=h,h=a[25]-a[17],a[25]=h,h=a[21]-h,a[21]=h,h=a[29]-h,a[29]=h,h=a[17]-a[1],a[17]=h,h=a[9]-h,a[9]=h,h=a[25]-h,a[25]=h,h=a[5]-h,a[5]=h,h=a[21]-h,a[21]=h,h=a[13]-h,a[13]=h,h=a[29]-h,a[29]=h,h=a[1]-a[0],a[1]=h,h=a[16]-h,a[16]=h,h=a[17]-h,a[17]=h,h=a[8]-h,a[8]=h,h=a[9]-h,a[9]=h,h=a[24]-h,a[24]=h,h=a[25]-h,a[25]=h,h=a[4]-h,a[4]=h,h=a[5]-h,a[5]=h,h=a[20]-h,a[20]=h,h=a[21]-h,a[21]=h,h=a[12]-h,a[12]=h,h=a[13]-h,a[13]=h,h=a[28]-h,a[28]=h,h=a[29]-h,a[29]=h,h=a[0],a[0]+=a[31],a[31]-=h,h=a[1],a[1]+=a[30],a[30]-=h,h=a[16],a[16]+=a[15],a[15]-=h,h=a[17],a[17]+=a[14],a[14]-=h,h=a[8],a[8]+=a[23],a[23]-=h,h=a[9],a[9]+=a[22],a[22]-=h,h=a[24],a[24]+=a[7],a[7]-=h,h=a[25],a[25]+=a[6],a[6]-=h,h=a[4],a[4]+=a[27],a[27]-=h,h=a[5],a[5]+=a[26],a[26]-=h,h=a[20],a[20]+=a[11],a[11]-=h,h=a[21],a[21]+=a[10],a[10]-=h,h=a[12],a[12]+=a[19],a[19]-=h,h=a[13],a[13]+=a[18],a[18]-=h,h=a[28],a[28]+=a[3],a[3]-=h,h=a[29],a[29]+=a[2],a[2]-=h}function t(e,t){for(var a=0;a<3;a++){var s,r,i,_,o,l;r=(_=e[t+6]*n[K.SHORT_TYPE][0]-e[t+15])+(s=e[t+0]*n[K.SHORT_TYPE][2]-e[t+9]),i=_-s,o=(_=e[t+15]*n[K.SHORT_TYPE][0]+e[t+6])+(s=e[t+9]*n[K.SHORT_TYPE][2]+e[t+0]),l=-_+s,s=2.069978111953089e-11*(e[t+3]*n[K.SHORT_TYPE][1]-e[t+12]),_=2.069978111953089e-11*(e[t+12]*n[K.SHORT_TYPE][1]+e[t+3]),e[t+0]=1.90752519173728e-11*r+s,e[t+15]=1.90752519173728e-11*-o+_,i=.8660254037844387*i*1.907525191737281e-11,o=.5*o*1.907525191737281e-11+_,e[t+3]=i-o,e[t+6]=i+o,r=.5*r*1.907525191737281e-11-s,l=.8660254037844387*l*1.907525191737281e-11,e[t+9]=r+l,e[t+12]=r-l,t++}}function a(e,t,a){var s,n,r,_,o,l,f,c,h,u;r=a[17]-a[9],o=a[15]-a[11],l=a[14]-a[12],f=a[0]+a[8],c=a[1]+a[7],h=a[2]+a[6],u=a[3]+a[5],e[t+17]=f+h-u-(c-a[4]),n=(f+h-u)*i[19]+(c-a[4]),s=(r-o-l)*i[18],e[t+5]=s+n,e[t+6]=s-n,_=(a[16]-a[10])*i[18],c=c*i[19]+a[4],s=r*i[12]+_+o*i[13]+l*i[14],n=-f*i[16]+c-h*i[17]+u*i[15],e[t+1]=s+n,e[t+2]=s-n,s=r*i[13]-_-o*i[14]+l*i[12],n=-f*i[17]+c-h*i[15]+u*i[16],e[t+9]=s+n,e[t+10]=s-n,s=r*i[14]-_+o*i[12]-l*i[13],n=f*i[15]-c+h*i[16]-u*i[17],e[t+13]=s+n,e[t+14]=s-n;var b,m,p,d,v,g,S,M;b=a[8]-a[0],p=a[6]-a[2],d=a[5]-a[3],v=a[17]+a[9],g=a[16]+a[10],S=a[15]+a[11],M=a[14]+a[12],e[t+0]=v+S+M+(g+a[13]),s=(v+S+M)*i[19]-(g+a[13]),n=(b-p+d)*i[18],e[t+11]=s+n,e[t+12]=s-n,m=(a[7]-a[1])*i[18],g=a[13]-g*i[19],s=v*i[15]-g+S*i[16]+M*i[17],n=b*i[14]+m+p*i[12]+d*i[13],e[t+3]=s+n,e[t+4]=s-n,s=-v*i[17]+g-S*i[15]-M*i[16],n=b*i[13]+m-p*i[14]-d*i[12],e[t+7]=s+n,e[t+8]=s-n,s=-v*i[16]+g-S*i[17]-M*i[15],n=b*i[12]-m+p*i[13]-d*i[14],e[t+15]=s+n,e[t+16]=s-n}var s=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*P.SQRT2*.5/2384e-9,.017876148*P.SQRT2*.5/2384e-9,.003134727*P.SQRT2*.5/2384e-9,.002457142*P.SQRT2*.5/2384e-9,971317e-9*P.SQRT2*.5/2384e-9,218868e-9*P.SQRT2*.5/2384e-9,101566e-9*P.SQRT2*.5/2384e-9,13828e-9*P.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],n=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],r=n[K.SHORT_TYPE],i=n[K.SHORT_TYPE],_=n[K.SHORT_TYPE],o=n[K.SHORT_TYPE],l=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(s,i,f){for(var c=i,h=286,u=0;u<s.channels_out;u++){for(var b=0;b<s.mode_gr;b++){for(var m,p=s.l3_side.tt[b][u],d=p.xr,v=0,g=s.sb_sample[u][1-b],S=0,M=0;M<9;M++)for(e(c,h,g[S]),e(c,h+32,g[S+1]),S+=2,h+=64,m=1;m<32;m+=2)g[S-1][m]*=-1;for(m=0;m<32;m++,v+=18){var R=p.block_type,A=s.sb_sample[u][b],B=s.sb_sample[u][1-b];if(0!=p.mixed_block_flag&&m<2&&(R=0),s.amp_filter[m]<1e-12)I.fill(d,v+0,v+18,0);else{if(s.amp_filter[m]<1)for(M=0;M<18;M++)B[M][l[m]]*=s.amp_filter[m];if(R==K.SHORT_TYPE){for(M=-3;M<0;M++){var w=n[K.SHORT_TYPE][M+3];d[v+3*M+9]=A[9+M][l[m]]*w-A[8-M][l[m]],d[v+3*M+18]=A[14-M][l[m]]*w+A[15+M][l[m]],d[v+3*M+10]=A[15+M][l[m]]*w-A[14-M][l[m]],d[v+3*M+19]=B[2-M][l[m]]*w+B[3+M][l[m]],d[v+3*M+11]=B[3+M][l[m]]*w-B[2-M][l[m]],d[v+3*M+20]=B[8-M][l[m]]*w+B[9+M][l[m]]}t(d,v)}else{for(var E=L(18),M=-9;M<0;M++){var T,y;T=n[R][M+27]*B[M+9][l[m]]+n[R][M+36]*B[8-M][l[m]],y=n[R][M+9]*A[M+9][l[m]]-n[R][M+18]*A[8-M][l[m]],E[M+9]=T-y*r[3+M+9],E[M+18]=T*r[3+M+9]+y}a(d,v,E)}}if(R!=K.SHORT_TYPE&&0!=m)for(M=7;M>=0;--M){var k,P;k=d[v+M]*_[20+M]+d[v+-1-M]*o[28+M],P=d[v+M]*o[28+M]-d[v+-1-M]*_[20+M],d[v+-1-M]=k,d[v+M]=P}}}if(c=f,h=286,1==s.mode_gr)for(var H=0;H<18;H++)x.arraycopy(s.sb_sample[u][1][H],0,s.sb_sample[u][0][H],0,32)}}},V=k.System,N=k.new_float,O=k.new_float_n,X=function(){this.l=N(K.SBMAX_l),this.s=O([K.SBMAX_s,3]);var e=this;this.assign=function(t){V.arraycopy(t.l,0,e.l,0,K.SBMAX_l);for(var a=0;a<K.SBMAX_s;a++)for(var s=0;s<3;s++)e.s[a][s]=t.s[a][s]}},D=function(){this.thm=new X,this.en=new X},Y=k.System,q=k.VbrMode,F=k.new_array_n,C=k.new_float,G=k.new_float_n,j=k.new_int,z=k.assert;l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5];var K=l,Z=k.Util,U=k.new_float,Q=function(){function e(e,t,a){var n,r,i,_=0,o=t+(a<<=1);n=4;do{var l,f,c,h,u,b,m;m=n>>1,b=(u=n<<1)+(h=n),n=u<<1,i=(r=t)+m;do{R=e[r+0]-e[r+h],M=e[r+0]+e[r+h],E=e[r+u]-e[r+b],B=e[r+u]+e[r+b],e[r+u]=M-B,e[r+0]=M+B,e[r+b]=R-E,e[r+h]=R+E,R=e[i+0]-e[i+h],M=e[i+0]+e[i+h],E=Z.SQRT2*e[i+b],B=Z.SQRT2*e[i+u],e[i+u]=M-B,e[i+0]=M+B,e[i+b]=R-E,e[i+h]=R+E,i+=n,r+=n}while(r<o);for(f=s[_+0],l=s[_+1],c=1;c<m;c++){var p,d;p=1-2*l*l,d=2*l*f,r=t+c,i=t+h-c;do{var v,g,S,M,R,A,B,w,E,T;g=d*e[r+h]-p*e[i+h],v=p*e[r+h]+d*e[i+h],R=e[r+0]-v,M=e[r+0]+v,A=e[i+0]-g,S=e[i+0]+g,g=d*e[r+b]-p*e[i+b],v=p*e[r+b]+d*e[i+b],E=e[r+u]-v,B=e[r+u]+v,T=e[i+u]-g,w=e[i+u]+g,g=l*B-f*T,v=f*B+l*T,e[r+u]=M-v,e[r+0]=M+v,e[i+b]=A-g,e[i+h]=A+g,g=f*w-l*E,v=l*w+f*E,e[i+u]=S-v,e[i+0]=S+v,e[r+b]=R-g,e[r+h]=R+g,i+=n,r+=n}while(r<o);f=(p=f)*s[_+0]-l*s[_+1],l=p*s[_+1]+l*s[_+0]}_+=2}while(n<a)}var t=U(K.BLKSIZE),a=U(K.BLKSIZE_s/2),s=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],n=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(t,s,r,i,_){for(var o=0;o<3;o++){var l=K.BLKSIZE_s/2,f=65535&192*(o+1),c=K.BLKSIZE_s/8-1;do{var h,u,b,m,p,d=255&n[c<<2];u=(h=a[d]*i[r][_+d+f])-(p=a[127-d]*i[r][_+d+f+128]),h+=p,m=(b=a[d+64]*i[r][_+d+f+64])-(p=a[63-d]*i[r][_+d+f+192]),b+=p,l-=4,s[o][l+0]=h+b,s[o][l+2]=h-b,s[o][l+1]=u+m,s[o][l+3]=u-m,u=(h=a[d+1]*i[r][_+d+f+1])-(p=a[126-d]*i[r][_+d+f+129]),h+=p,m=(b=a[d+65]*i[r][_+d+f+65])-(p=a[62-d]*i[r][_+d+f+193]),b+=p,s[o][l+K.BLKSIZE_s/2+0]=h+b,s[o][l+K.BLKSIZE_s/2+2]=h-b,s[o][l+K.BLKSIZE_s/2+1]=u+m,s[o][l+K.BLKSIZE_s/2+3]=u-m}while(--c>=0);e(s[o],l,K.BLKSIZE_s/2)}},this.fft_long=function(a,s,r,i,_){var o=K.BLKSIZE/8-1,l=K.BLKSIZE/2;do{var f,c,h,u,b,m=255&n[o];c=(f=t[m]*i[r][_+m])-(b=t[m+512]*i[r][_+m+512]),f+=b,u=(h=t[m+256]*i[r][_+m+256])-(b=t[m+768]*i[r][_+m+768]),h+=b,s[0+(l-=4)]=f+h,s[l+2]=f-h,s[l+1]=c+u,s[l+3]=c-u,c=(f=t[m+1]*i[r][_+m+1])-(b=t[m+513]*i[r][_+m+513]),f+=b,u=(h=t[m+257]*i[r][_+m+257])-(b=t[m+769]*i[r][_+m+769]),h+=b,s[l+K.BLKSIZE/2+0]=f+h,s[l+K.BLKSIZE/2+2]=f-h,s[l+K.BLKSIZE/2+1]=c+u,s[l+K.BLKSIZE/2+3]=c-u}while(--o>=0);e(s,l,K.BLKSIZE/2)},this.init_fft=function(e){for(s=0;s<K.BLKSIZE;s++)t[s]=.42-.5*Math.cos(2*Math.PI*(s+.5)/K.BLKSIZE)+.08*Math.cos(4*Math.PI*(s+.5)/K.BLKSIZE);for(var s=0;s<K.BLKSIZE_s/2;s++)a[s]=.5*(1-Math.cos(2*Math.PI*(s+.5)/K.BLKSIZE_s))}},W=k.VbrMode,J=k.Float,$=k.ShortBlock,ee=k.Util,te=k.Arrays,ae=k.new_float,se=k.new_float_n,ne=k.new_int,re=k.assert,ie=function(){function e(e){return e}function t(e,t){for(var a=0,s=0;s<K.BLKSIZE/2;++s)a+=e[s]*t.ATH.eql_w[s];return a*=U}function a(a,s,n,r,i,_,o,l,f,c,h){var u=a.internal_flags;if(f<2)q.fft_long(u,r[i],f,c,h),q.fft_short(u,_[o],f,c,h);else if(2==f){for(S=K.BLKSIZE-1;S>=0;--S){var b=r[i+0][S],m=r[i+1][S];r[i+0][S]=(b+m)*ee.SQRT2*.5,r[i+1][S]=(b-m)*ee.SQRT2*.5}for(v=2;v>=0;--v)for(S=K.BLKSIZE_s-1;S>=0;--S){var b=_[o+0][v][S],m=_[o+1][v][S];_[o+0][v][S]=(b+m)*ee.SQRT2*.5,_[o+1][v][S]=(b-m)*ee.SQRT2*.5}}for(s[0]=e(r[i+0][0]),s[0]*=s[0],S=K.BLKSIZE/2-1;S>=0;--S){var p=r[i+0][K.BLKSIZE/2-S],d=r[i+0][K.BLKSIZE/2+S];s[K.BLKSIZE/2-S]=e(.5*(p*p+d*d))}for(var v=2;v>=0;--v)for(n[v][0]=_[o+0][v][0],n[v][0]*=n[v][0],S=K.BLKSIZE_s/2-1;S>=0;--S){var p=_[o+0][v][K.BLKSIZE_s/2-S],d=_[o+0][v][K.BLKSIZE_s/2+S];n[v][K.BLKSIZE_s/2-S]=e(.5*(p*p+d*d))}for(var g=0,S=11;S<K.HBLKSIZE;S++)g+=s[S];if(u.tot_ener[f]=g,a.analysis){for(S=0;S<K.HBLKSIZE;S++)u.pinfo.energy[l][f][S]=u.pinfo.energy_save[f][S],u.pinfo.energy_save[f][S]=s[S];u.pinfo.pe[l][f]=u.pe[f]}2==a.athaa_loudapprox&&f<2&&(u.loudness_sq[l][f]=u.loudness_sq_save[f],u.loudness_sq_save[f]=t(s,u))}function s(){X=Math.pow(10,(le+1)/16),D=Math.pow(10,(fe+1)/16),Y=Math.pow(10,ce/10)}function n(e,t,a,s,n,r){var i;if(t>e){if(!(t<e*D))return e+t;i=t/e}else{if(e>=t*D)return e+t;i=e/t}if(re(e>=0),re(t>=0),e+=t,s+3<=6)return i>=X?e:(_=0|ee.FAST_LOG10_X(i,16),e*be[_]);var _=0|ee.FAST_LOG10_X(i,16);if(t=0!=r?n.ATH.cb_s[a]*n.ATH.adjust:n.ATH.cb_l[a]*n.ATH.adjust,re(t>=0),e<Y*t){if(e>t){var o,l;return o=1,_<=13&&(o=me[_]),l=ee.FAST_LOG10_X(e/t,10/15),e*((ue[_]-o)*l+o)}return _>13?e:e*me[_]}return e*ue[_]}function r(e,t,a){var s;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(s=t>e?t/e:e/t,-2<=a&&a<=2){if(s>=X)return e+t;var n=0|ee.FAST_LOG10_X(s,16);return(e+t)*pe[n]}return s<D?e+t:(e<t&&(e=t),e)}function i(e,t){var a=e.internal_flags;if(a.channels_out>1){for(r=0;r<K.SBMAX_l;r++){var s=a.thm[0].l[r],n=a.thm[1].l[r];a.thm[0].l[r]+=n*t,a.thm[1].l[r]+=s*t}for(var r=0;r<K.SBMAX_s;r++)for(var i=0;i<3;i++){var s=a.thm[0].s[r][i],n=a.thm[1].s[r][i];a.thm[0].s[r][i]+=n*t,a.thm[1].s[r][i]+=s*t}}}function _(e){for(s=0;s<K.SBMAX_l;s++)if(!(e.thm[0].l[s]>1.58*e.thm[1].l[s]||e.thm[1].l[s]>1.58*e.thm[0].l[s])){var t=e.mld_l[s]*e.en[3].l[s],a=Math.max(e.thm[2].l[s],Math.min(e.thm[3].l[s],t));t=e.mld_l[s]*e.en[2].l[s],r=Math.max(e.thm[3].l[s],Math.min(e.thm[2].l[s],t)),e.thm[2].l[s]=a,e.thm[3].l[s]=r}for(var s=0;s<K.SBMAX_s;s++)for(var n=0;n<3;n++)if(!(e.thm[0].s[s][n]>1.58*e.thm[1].s[s][n]||e.thm[1].s[s][n]>1.58*e.thm[0].s[s][n])){var t=e.mld_s[s]*e.en[3].s[s][n],a=Math.max(e.thm[2].s[s][n],Math.min(e.thm[3].s[s][n],t));t=e.mld_s[s]*e.en[2].s[s][n];var r=Math.max(e.thm[3].s[s][n],Math.min(e.thm[2].s[s][n],t));e.thm[2].s[s][n]=a,e.thm[3].s[s][n]=r}}function o(e,t,a){var s=t,n=Math.pow(10,a);for(t*=2,s*=2,r=0;r<K.SBMAX_l;r++)f=e.ATH.cb_l[e.bm_l[r]]*n,(_=Math.min(Math.max(e.thm[0].l[r],f),Math.max(e.thm[1].l[r],f)))*t<(o=Math.max(e.thm[2].l[r],f))+(l=Math.max(e.thm[3].l[r],f))&&re((o*=c=_*s/(o+l))+(l*=c)>0),e.thm[2].l[r]=Math.min(o,e.thm[2].l[r]),e.thm[3].l[r]=Math.min(l,e.thm[3].l[r]);n*=K.BLKSIZE_s/K.BLKSIZE;for(var r=0;r<K.SBMAX_s;r++)for(var i=0;i<3;i++){var _,o,l,f;if(f=e.ATH.cb_s[e.bm_s[r]]*n,_=Math.min(Math.max(e.thm[0].s[r][i],f),Math.max(e.thm[1].s[r][i],f)),o=Math.max(e.thm[2].s[r][i],f),l=Math.max(e.thm[3].s[r][i],f),_*t<o+l){var c=_*t/(o+l);re((o*=c)+(l*=c)>0)}e.thm[2].s[r][i]=Math.min(e.thm[2].s[r][i],o),e.thm[3].s[r][i]=Math.min(e.thm[3].s[r][i],l)}}function l(e,t,a,s,n){var r,i,_=0,o=0;for(r=i=0;r<K.SBMAX_s;++i,++r){for(var l=e.bo_s[r],f=e.npart_s,c=l<f?l:f;i<c;)re(t[i]>=0),re(a[i]>=0),_+=t[i],o+=a[i],i++;if(e.en[s].s[r][n]=_,e.thm[s].s[r][n]=o,i>=f){++r;break}re(t[i]>=0),re(a[i]>=0);var h=e.PSY.bo_s_weight[r],u=1-h;_=h*t[i],o=h*a[i],e.en[s].s[r][n]+=_,e.thm[s].s[r][n]+=o,_=u*t[i],o=u*a[i]}for(;r<K.SBMAX_s;++r)e.en[s].s[r][n]=0,e.thm[s].s[r][n]=0}function f(e,t,a,s){var n,r,i=0,_=0;for(n=r=0;n<K.SBMAX_l;++r,++n){for(var o=e.bo_l[n],l=e.npart_l,f=o<l?o:l;r<f;)re(t[r]>=0),re(a[r]>=0),i+=t[r],_+=a[r],r++;if(e.en[s].l[n]=i,e.thm[s].l[n]=_,r>=l){++n;break}re(t[r]>=0),re(a[r]>=0);var c=e.PSY.bo_l_weight[n],h=1-c;i=c*t[r],_=c*a[r],e.en[s].l[n]+=i,e.thm[s].l[n]+=_,i=h*t[r],_=h*a[r]}for(;n<K.SBMAX_l;++n)e.en[s].l[n]=0,e.thm[s].l[n]=0}function c(e,t,a,s,n,r){var i,_,o=e.internal_flags;for(_=i=0;_<o.npart_s;++_){for(var l=0,f=0,c=o.numlines_s[_],h=0;h<c;++h,++i){var u=t[r][i];l+=u,f<u&&(f=u)}a[_]=l}for(re(_==o.npart_s),re(129==i),i=_=0;_<o.npart_s;_++){var b=o.s3ind_s[_][0],m=o.s3_ss[i++]*a[b];for(++b;b<=o.s3ind_s[_][1];)m+=o.s3_ss[i]*a[b],++i,++b;if(p=j*o.nb_s1[n][_],s[_]=Math.min(m,p),o.blocktype_old[1&n]==K.SHORT_TYPE){var p=z*o.nb_s2[n][_],d=s[_];s[_]=Math.min(p,d)}o.nb_s2[n][_]=o.nb_s1[n][_],o.nb_s1[n][_]=m,re(s[_]>=0)}for(;_<=K.CBANDS;++_)a[_]=0,s[_]=0}function h(e,t,a,s){var n=e.internal_flags;e.short_blocks!=$.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<n.channels_out;r++)s[r]=K.NORM_TYPE,e.short_blocks==$.short_block_dispensed&&(t[r]=1),e.short_blocks==$.short_block_forced&&(t[r]=0),0!=t[r]?(re(n.blocktype_old[r]!=K.START_TYPE),n.blocktype_old[r]==K.SHORT_TYPE&&(s[r]=K.STOP_TYPE)):(s[r]=K.SHORT_TYPE,n.blocktype_old[r]==K.NORM_TYPE&&(n.blocktype_old[r]=K.START_TYPE),n.blocktype_old[r]==K.STOP_TYPE&&(n.blocktype_old[r]=K.SHORT_TYPE)),a[r]=n.blocktype_old[r],n.blocktype_old[r]=s[r]}function u(e,t,a){return a>=1?e:a<=0?t:t>0?Math.pow(e/t,a)*t:0}function b(e,t){for(var a=309.07,s=0;s<K.SBMAX_s-1;s++)for(var n=0;n<3;n++){var r=e.thm.s[s][n];if(re(s<de.length),r>0){var i=r*t,_=e.en.s[s][n];_>i&&(_>1e10*i?a+=de[s]*(10*F):(re(i>0),a+=de[s]*ee.FAST_LOG10(_/i)))}}return a}function m(e,t){for(var a=281.0575,s=0;s<K.SBMAX_l-1;s++){var n=e.thm.l[s];if(re(s<ve.length),n>0){var r=n*t,i=e.en.l[s];i>r&&(i>1e10*r?a+=ve[s]*(10*F):(re(r>0),a+=ve[s]*ee.FAST_LOG10(i/r)))}}return a}function p(e,t,a,s,n){var r,i;for(r=i=0;r<e.npart_l;++r){var _,o=0,l=0;for(_=0;_<e.numlines_l[r];++_,++i){var f=t[i];re(f>=0),o+=f,l<f&&(l=f)}a[r]=o,s[r]=l,n[r]=o*e.rnumlines_l[r],re(e.rnumlines_l[r]>=0),re(o>=0),re(a[r]>=0),re(s[r]>=0),re(n[r]>=0)}}function d(e,t,a,s){var n=he.length-1,r=0,i=a[r]+a[r+1];for(re(i>=0),i>0?((_=t[r])<t[r+1]&&(_=t[r+1]),re(e.numlines_l[r]+e.numlines_l[r+1]-1>0),(o=0|(i=20*(2*_-i)/(i*(e.numlines_l[r]+e.numlines_l[r+1]-1))))>n&&(o=n),s[r]=o):s[r]=0,r=1;r<e.npart_l-1;r++)i=a[r-1]+a[r]+a[r+1],re(i>=0),i>0?((_=t[r-1])<t[r]&&(_=t[r]),_<t[r+1]&&(_=t[r+1]),re(e.numlines_l[r-1]+e.numlines_l[r]+e.numlines_l[r+1]-1>0),(o=0|(i=20*(3*_-i)/(i*(e.numlines_l[r-1]+e.numlines_l[r]+e.numlines_l[r+1]-1))))>n&&(o=n),s[r]=o):s[r]=0;if(re(r>0),re(r==e.npart_l-1),i=a[r-1]+a[r],re(i>=0),i>0){var _=t[r-1];_<t[r]&&(_=t[r]),re(e.numlines_l[r-1]+e.numlines_l[r]-1>0);var o=0|(i=20*(2*_-i)/(i*(e.numlines_l[r-1]+e.numlines_l[r]-1)));o>n&&(o=n),s[r]=o}else s[r]=0;re(r==e.npart_l-1)}function v(t,a,s,n,r,i,_,o){var l=t.internal_flags;if(n<2)q.fft_long(l,_[o],n,a,s);else if(2==n)for(m=K.BLKSIZE-1;m>=0;--m){var f=_[o+0][m],c=_[o+1][m];_[o+0][m]=(f+c)*ee.SQRT2*.5,_[o+1][m]=(f-c)*ee.SQRT2*.5}for(i[0]=e(_[o+0][0]),i[0]*=i[0],m=K.BLKSIZE/2-1;m>=0;--m){var h=_[o+0][K.BLKSIZE/2-m],u=_[o+0][K.BLKSIZE/2+m];i[K.BLKSIZE/2-m]=e(.5*(h*h+u*u))}for(var b=0,m=11;m<K.HBLKSIZE;m++)b+=i[m];if(l.tot_ener[n]=b,t.analysis){for(m=0;m<K.HBLKSIZE;m++)l.pinfo.energy[r][n][m]=l.pinfo.energy_save[n][m],l.pinfo.energy_save[n][m]=i[m];l.pinfo.pe[r][n]=l.pe[n]}}function g(t,a,s,n,r,i,_,o){var l=t.internal_flags;if(0==r&&n<2&&q.fft_short(l,_[o],n,a,s),2==n)for(h=K.BLKSIZE_s-1;h>=0;--h){var f=_[o+0][r][h],c=_[o+1][r][h];_[o+0][r][h]=(f+c)*ee.SQRT2*.5,_[o+1][r][h]=(f-c)*ee.SQRT2*.5}i[r][0]=_[o+0][r][0],i[r][0]*=i[r][0];for(var h=K.BLKSIZE_s/2-1;h>=0;--h){var u=_[o+0][r][K.BLKSIZE_s/2-h],b=_[o+0][r][K.BLKSIZE_s/2+h];i[r][K.BLKSIZE_s/2-h]=e(.5*(u*u+b*b))}}function S(e,a,s,n){var r=e.internal_flags;2==e.athaa_loudapprox&&s<2&&(r.loudness_sq[a][s]=r.loudness_sq_save[s],r.loudness_sq_save[s]=t(n,r))}function M(e,t,a,s,n,r,i,_,o,l){for(var f=se([2,576]),c=e.internal_flags,h=c.channels_out,u=e.mode==MPEGMode.JOINT_STEREO?4:h,b=0;b<h;b++){firbuf=t[b];var m=a+576-350-_e+192;for(re(Se.length==(_e-1)/2),w=0;w<576;w++){var p,d;for(p=firbuf[m+w+10],d=0,E=0;E<(_e-1)/2-1;E+=2)p+=Se[E]*(firbuf[m+w+E]+firbuf[m+w+_e-E]),d+=Se[E+1]*(firbuf[m+w+E+1]+firbuf[m+w+_e-E-1]);f[b][w]=p+d}n[s][b].en.assign(c.en[b]),n[s][b].thm.assign(c.thm[b]),u>2&&(r[s][b].en.assign(c.en[b+2]),r[s][b].thm.assign(c.thm[b+2]))}for(b=0;b<u;b++){var v=ae(12),g=ae(12),S=[0,0,0,0],M=f[1&b],R=0,A=3==b?c.nsPsy.attackthre_s:c.nsPsy.attackthre,B=1;if(2==b)for(var w=0,E=576;E>0;++w,--E){var T=f[0][w],y=f[1][w];f[0][w]=T+y,f[1][w]=T-y}for(w=0;w<3;w++)g[w]=c.nsPsy.last_en_subshort[b][w+6],re(c.nsPsy.last_en_subshort[b][w+4]>0),v[w]=g[w]/c.nsPsy.last_en_subshort[b][w+4],S[0]+=g[w];for(w=0;w<9;w++){for(var k=R+64,x=1;R<k;R++)x<Math.abs(M[R])&&(x=Math.abs(M[R]));c.nsPsy.last_en_subshort[b][w]=g[w+3]=x,S[1+w/3]+=x,x>g[w+3-2]?(re(g[w+3-2]>0),x/=g[w+3-2]):g[w+3-2]>10*x?(re(x>0),x=g[w+3-2]/(10*x)):x=0,v[w+3]=x}for(w=0;w<3;++w){var P=g[3*w+3]+g[3*w+4]+g[3*w+5],I=1;6*g[3*w+5]<P&&(I*=.5,6*g[3*w+4]<P&&(I*=.5)),_[b][w]=I}if(e.analysis){for(var L=v[0],w=1;w<12;w++)L<v[w]&&(L=v[w]);c.pinfo.ers[s][b]=c.pinfo.ers_save[b],c.pinfo.ers_save[b]=L}for(w=0;w<12;w++)0==o[b][w/3]&&v[w]>A&&(o[b][w/3]=w%3+1);for(w=1;w<4;w++){var H=S[w-1],V=S[w];Math.max(H,V)<4e4&&H<1.7*V&&V<1.7*H&&(1==w&&o[b][0]<=o[b][w]&&(o[b][0]=0),o[b][w]=0)}o[b][0]<=c.nsPsy.lastAttacks[b]&&(o[b][0]=0),3!=c.nsPsy.lastAttacks[b]&&o[b][0]+o[b][1]+o[b][2]+o[b][3]==0||(B=0,0!=o[b][1]&&0!=o[b][0]&&(o[b][1]=0),0!=o[b][2]&&0!=o[b][1]&&(o[b][2]=0),0!=o[b][3]&&0!=o[b][2]&&(o[b][3]=0)),b<2?l[b]=B:0==B&&(l[0]=l[1]=0),i[b]=c.tot_ener[b]}}function R(e,t,a){if(0==a)for(var s=0;s<e.npart_s;s++)e.nb_s2[t][s]=e.nb_s1[t][s],e.nb_s1[t][s]=0}function A(e,t){for(var a=0;a<e.npart_l;a++)e.nb_2[t][a]=e.nb_1[t][a],e.nb_1[t][a]=0}function B(e,t,a,s){var n=he.length-1,r=0,i=a[r]+a[r+1];for(re(i>=0),i>0?((_=t[r])<t[r+1]&&(_=t[r+1]),re(e.numlines_s[r]+e.numlines_s[r+1]-1>0),(o=0|(i=20*(2*_-i)/(i*(e.numlines_s[r]+e.numlines_s[r+1]-1))))>n&&(o=n),s[r]=o):s[r]=0,r=1;r<e.npart_s-1;r++)i=a[r-1]+a[r]+a[r+1],re(r+1<e.npart_s),re(i>=0),i>0?((_=t[r-1])<t[r]&&(_=t[r]),_<t[r+1]&&(_=t[r+1]),re(e.numlines_s[r-1]+e.numlines_s[r]+e.numlines_s[r+1]-1>0),(o=0|(i=20*(3*_-i)/(i*(e.numlines_s[r-1]+e.numlines_s[r]+e.numlines_s[r+1]-1))))>n&&(o=n),s[r]=o):s[r]=0;if(re(r>0),re(r==e.npart_s-1),i=a[r-1]+a[r],re(i>=0),i>0){var _=t[r-1];_<t[r]&&(_=t[r]),re(e.numlines_s[r-1]+e.numlines_s[r]-1>0);var o=0|(i=20*(2*_-i)/(i*(e.numlines_s[r-1]+e.numlines_s[r]-1)));o>n&&(o=n),s[r]=o}else s[r]=0;re(r==e.npart_s-1)}function w(e,t,a,s,n,i){var _,o,l,f=e.internal_flags,c=new float[K.CBANDS],h=ae(K.CBANDS),u=new int[K.CBANDS];for(l=o=0;l<f.npart_s;++l){var b=0,m=0,p=f.numlines_s[l];for(_=0;_<p;++_,++o){var d=t[i][o];b+=d,m<d&&(m=d)}a[l]=b,re(b>=0),c[l]=m,re(p>0),h[l]=b/p,re(h[l]>=0)}for(re(l==f.npart_s),re(129==o);l<K.CBANDS;++l)c[l]=0,h[l]=0;for(B(f,c,h,u),o=l=0;l<f.npart_s;l++){var v,g,S,M,R,A=f.s3ind_s[l][0],w=f.s3ind_s[l][1];for(v=u[A],g=1,M=f.s3_ss[o]*a[A]*he[u[A]],++o,++A;A<=w;)v+=u[A],g+=1,M=r(M,S=f.s3_ss[o]*a[A]*he[u[A]],A-l),++o,++A;M*=R=.5*he[v=(1+2*v)/(2*g)],s[l]=M,f.nb_s2[n][l]=f.nb_s1[n][l],f.nb_s1[n][l]=M,S=c[l],S*=f.minval_s[l],S*=R,s[l]>S&&(s[l]=S),f.masking_lower>1&&(s[l]*=f.masking_lower),s[l]>a[l]&&(s[l]=a[l]),f.masking_lower<1&&(s[l]*=f.masking_lower),re(s[l]>=0)}for(;l<K.CBANDS;++l)a[l]=0,s[l]=0}function E(e,t,a,s,n){var i,_=ae(K.CBANDS),o=ae(K.CBANDS),l=ne(K.CBANDS+2);p(e,t,a,_,o),d(e,_,o,l);var f=0;for(i=0;i<e.npart_l;i++){var c,h,u,b=e.s3ind[i][0],m=e.s3ind[i][1],v=0,g=0;for(v=l[b],g+=1,h=e.s3_ll[f]*a[b]*he[l[b]],++f,++b;b<=m;)v+=l[b],g+=1,h=r(h,c=e.s3_ll[f]*a[b]*he[l[b]],b-i),++f,++b;if(v=(1+2*v)/(2*g),u=.5*he[v],h*=u,e.blocktype_old[1&n]==K.SHORT_TYPE)S=C*e.nb_1[n][i],s[i]=S>0?Math.min(h,S):Math.min(h,a[i]*ie);else{var S,M=G*e.nb_2[n][i],R=C*e.nb_1[n][i];M<=0&&(M=h),R<=0&&(R=h),S=e.blocktype_old[1&n]==K.NORM_TYPE?Math.min(R,M):R,s[i]=Math.min(h,S)}e.nb_2[n][i]=e.nb_1[n][i],e.nb_1[n][i]=h,c=_[i],c*=e.minval_l[i],c*=u,s[i]>c&&(s[i]=c),e.masking_lower>1&&(s[i]*=e.masking_lower),s[i]>a[i]&&(s[i]=a[i]),e.masking_lower<1&&(s[i]*=e.masking_lower),re(s[i]>=0)}for(;i<K.CBANDS;++i)a[i]=0,s[i]=0}function T(e,t){var a=e.internal_flags;e.short_blocks!=$.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<a.channels_out;s++)e.short_blocks==$.short_block_dispensed&&(t[s]=1),e.short_blocks==$.short_block_forced&&(t[s]=0)}function y(e,t,a){for(var s=e.internal_flags,n=0;n<s.channels_out;n++){var r=K.NORM_TYPE;0!=t[n]?(re(s.blocktype_old[n]!=K.START_TYPE),s.blocktype_old[n]==K.SHORT_TYPE&&(r=K.STOP_TYPE)):(r=K.SHORT_TYPE,s.blocktype_old[n]==K.NORM_TYPE&&(s.blocktype_old[n]=K.START_TYPE),s.blocktype_old[n]==K.STOP_TYPE&&(s.blocktype_old[n]=K.SHORT_TYPE)),a[n]=s.blocktype_old[n],s.blocktype_old[n]=r}}function k(e,t,a,s,n,r,i){for(var _,o,l=2*r,f=r>0?Math.pow(10,n):1,c=0;c<i;++c){var h=e[2][c],u=e[3][c],b=t[0][c],m=t[1][c],p=t[2][c],d=t[3][c];if(b<=1.58*m&&m<=1.58*b){var v=a[c]*u,g=a[c]*h;o=Math.max(p,Math.min(d,v)),_=Math.max(d,Math.min(p,g))}else o=p,_=d;if(r>0){var S,M,R=s[c]*f;if(S=Math.min(Math.max(b,R),Math.max(m,R)),p=Math.max(o,R),d=Math.max(_,R),(M=p+d)>0&&S*l<M){var A=S*l/M;p*=A,d*=A,re(M>0)}o=Math.min(p,o),_=Math.min(d,_)}o>h&&(o=h),_>u&&(_=u),t[2][c]=o,t[3][c]=_}}function x(e,t){var a,s=e;return(a=s>=0?27*-s:s*t)<=-72?0:Math.exp(a*oe)}function P(e){var t=0,a=0,s=0;for(s=0;x(s,e)>1e-20;s-=1);for(n=s,r=0;Math.abs(r-n)>1e-12;)x(s=(r+n)/2,e)>0?r=s:n=s;t=n;var n,r,s=0;for(s=0;x(s,e)>1e-20;s+=1);for(n=0,r=s;Math.abs(r-n)>1e-12;)x(s=(r+n)/2,e)>0?n=s:r=s;a=r;var i,_=0;for(i=0;i<=1e3;++i)_+=x(s=t+i*(a-t)/1e3,e);return 1001/(_*(a-t))}function I(e){var t,a,s,n;return t=e,t*=t>=0?3:1.5,a=t>=.5&&t<=2.5?8*((n=t-.5)*n-2*n):0,t+=.474,(s=15.811389+7.5*t-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((a+s)*oe),t/=.6609193)}function L(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function H(e,t,a,s,n,r,i,_,o,l,f,c){var h,u=ae(K.CBANDS+1),b=_/(c>15?1152:384),m=ne(K.HBLKSIZE);_/=o;var p=0,d=0;for(h=0;h<K.CBANDS;h++){var v;for(T=L(_*p),u[h]=_*p,v=p;L(_*v)-T<Z&&v<=o/2;v++);for(e[h]=v-p,d=h+1;p<v;)re(p<K.HBLKSIZE),m[p++]=h;if(p>o/2){p=o/2,++h;break}}re(h<K.CBANDS),u[h]=_*p;for(var g=0;g<c;g++){var S,M,R,A,B;R=l[g],A=l[g+1],(S=0|Math.floor(.5+f*(R-.5)))<0&&(S=0),(M=0|Math.floor(.5+f*(A-.5)))>o/2&&(M=o/2),a[g]=(m[S]+m[M])/2,t[g]=m[M];var w=b*A;i[g]=(w-u[t[g]])/(u[t[g]+1]-u[t[g]]),i[g]<0?i[g]=0:i[g]>1&&(i[g]=1),B=L(_*l[g]*f),B=Math.min(B,15.5)/15.5,r[g]=Math.pow(10,1.25*(1-Math.cos(Math.PI*B))-2.5)}p=0;for(var E=0;E<d;E++){var T,y,k=e[E];T=L(_*p),y=L(_*(p+k-1)),s[E]=.5*(T+y),T=L(_*(p-.5)),y=L(_*(p+k-.5)),n[E]=y-T,p+=k}return d}function V(e,t,a,s,n,r){var i,_=se([K.CBANDS,K.CBANDS]),o=0;if(r)for(c=0;c<t;c++)for(i=0;i<t;i++)h=I(a[c]-a[i])*s[i],_[c][i]=h*n[c];else for(i=0;i<t;i++)for(var l=15+Math.min(21/a[i],12),f=P(l),c=0;c<t;c++){var h=f*x(a[c]-a[i],l)*s[i];_[c][i]=h*n[c]}for(c=0;c<t;c++){for(i=0;i<t&&!(_[c][i]>0);i++);for(e[c][0]=i,i=t-1;i>0&&!(_[c][i]>0);i--);e[c][1]=i,o+=e[c][1]-e[c][0]+1}for(var u=ae(o),b=0,c=0;c<t;c++)for(i=e[c][0];i<=e[c][1];i++)u[b++]=_[c][i];return u}function N(e){var t=L(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function O(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}var X,D,Y,q=new Q,F=2.302585092994046,C=2,G=16,j=2,z=16,Z=.34,U=1/217621504/(K.BLKSIZE/2),ie=.3,_e=21,oe=.2302585093,le=8,fe=23,ce=15,he=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],ue=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],be=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],me=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],pe=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],de=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],ve=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],ge=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_ns=function(e,t,s,r,v,g,S,M,R,A){var B,w,E,T,y,k,x,P,I,L=e.internal_flags,H=se([2,K.BLKSIZE]),V=se([2,3,K.BLKSIZE_s]),N=ae(K.CBANDS+1),O=ae(K.CBANDS+1),X=ae(K.CBANDS+2),D=ne(2),Y=ne(2),q=se([2,576]),F=ne(K.CBANDS+2),j=ne(K.CBANDS+2);for(te.fill(j,0),B=L.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(B=4),I=e.VBR==W.vbr_off?0==L.ResvMax?0:L.ResvSize/L.ResvMax*.5:e.VBR==W.vbr_rh||e.VBR==W.vbr_mtrh||e.VBR==W.vbr_mt?.6:1,w=0;w<L.channels_out;w++){var z=t[w],Z=s+576-350-_e+192;for(re(ge.length==(_e-1)/2),T=0;T<576;T++){var U,Q;for(U=z[Z+T+10],Q=0,y=0;y<(_e-1)/2-1;y+=2)U+=ge[y]*(z[Z+T+y]+z[Z+T+_e-y]),Q+=ge[y+1]*(z[Z+T+y+1]+z[Z+T+_e-y-1]);q[w][T]=U+Q}v[r][w].en.assign(L.en[w]),v[r][w].thm.assign(L.thm[w]),B>2&&(g[r][w].en.assign(L.en[w+2]),g[r][w].thm.assign(L.thm[w+2]))}for(w=0;w<B;w++){var J,$=ae(12),ee=[0,0,0,0],oe=ae(12),le=1,fe=ae(K.CBANDS),ce=ae(K.CBANDS),ue=[0,0,0,0],be=ae(K.HBLKSIZE),me=se([3,K.HBLKSIZE_s]);for(re(L.npart_s<=K.CBANDS),re(L.npart_l<=K.CBANDS),T=0;T<3;T++)$[T]=L.nsPsy.last_en_subshort[w][T+6],re(L.nsPsy.last_en_subshort[w][T+4]>0),oe[T]=$[T]/L.nsPsy.last_en_subshort[w][T+4],ee[0]+=$[T];if(2==w)for(T=0;T<576;T++){var pe,de;pe=q[0][T],de=q[1][T],q[0][T]=pe+de,q[1][T]=pe-de}var ve=q[1&w],Se=0;for(T=0;T<9;T++){for(var Me=Se+64,Re=1;Se<Me;Se++)Re<Math.abs(ve[Se])&&(Re=Math.abs(ve[Se]));L.nsPsy.last_en_subshort[w][T]=$[T+3]=Re,ee[1+T/3]+=Re,Re>$[T+3-2]?(re($[T+3-2]>0),Re/=$[T+3-2]):$[T+3-2]>10*Re?(re(Re>0),Re=$[T+3-2]/(10*Re)):Re=0,oe[T+3]=Re}if(e.analysis){var Ae=oe[0];for(T=1;T<12;T++)Ae<oe[T]&&(Ae=oe[T]);L.pinfo.ers[r][w]=L.pinfo.ers_save[w],L.pinfo.ers_save[w]=Ae}for(J=3==w?L.nsPsy.attackthre_s:L.nsPsy.attackthre,T=0;T<12;T++)0==ue[T/3]&&oe[T]>J&&(ue[T/3]=T%3+1);for(T=1;T<4;T++){var Be;ee[T-1]>ee[T]?(re(ee[T]>0),Be=ee[T-1]/ee[T]):(re(ee[T-1]>0),Be=ee[T]/ee[T-1]),Be<1.7&&(ue[T]=0,1==T&&(ue[0]=0))}for(0!=ue[0]&&0!=L.nsPsy.lastAttacks[w]&&(ue[0]=0),3!=L.nsPsy.lastAttacks[w]&&ue[0]+ue[1]+ue[2]+ue[3]==0||(le=0,0!=ue[1]&&0!=ue[0]&&(ue[1]=0),0!=ue[2]&&0!=ue[1]&&(ue[2]=0),0!=ue[3]&&0!=ue[2]&&(ue[3]=0)),w<2?Y[w]=le:0==le&&(Y[0]=Y[1]=0),R[w]=L.tot_ener[w],a(e,be,me,H,1&w,V,1&w,r,w,t,s),p(L,be,N,fe,ce),d(L,fe,ce,F),P=0;P<3;P++){var we,Ee;for(c(e,me,O,X,w,P),l(L,O,X,w,P),x=0;x<K.SBMAX_s;x++){if(Ee=L.thm[w].s[x][P],Ee*=.8,ue[P]>=2||1==ue[P+1]){var Te=0!=P?P-1:2,Re=u(L.thm[w].s[x][Te],Ee,.6*I);Ee=Math.min(Ee,Re)}if(1==ue[P]){var Te=0!=P?P-1:2,Re=u(L.thm[w].s[x][Te],Ee,ie*I);Ee=Math.min(Ee,Re)}else if(0!=P&&3==ue[P-1]||0==P&&3==L.nsPsy.lastAttacks[w]){var Te=2!=P?P+1:0,Re=u(L.thm[w].s[x][Te],Ee,ie*I);Ee=Math.min(Ee,Re)}we=$[3*P+3]+$[3*P+4]+$[3*P+5],6*$[3*P+5]<we&&(Ee*=.5,6*$[3*P+4]<we&&(Ee*=.5)),L.thm[w].s[x][P]=Ee}}for(L.nsPsy.lastAttacks[w]=ue[2],k=0,E=0;E<L.npart_l;E++){for(var ye=L.s3ind[E][0],ke=N[ye]*he[F[ye]],xe=L.s3_ll[k++]*ke;++ye<=L.s3ind[E][1];)ke=N[ye]*he[F[ye]],xe=n(xe,L.s3_ll[k++]*ke,ye,ye-E,L,0);xe*=.158489319246111,L.blocktype_old[1&w]==K.SHORT_TYPE?X[E]=xe:X[E]=u(Math.min(xe,Math.min(C*L.nb_1[w][E],G*L.nb_2[w][E])),xe,I),L.nb_2[w][E]=L.nb_1[w][E],L.nb_1[w][E]=xe}for(;E<=K.CBANDS;++E)N[E]=0,X[E]=0;f(L,N,X,w)}if(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&i(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO){var Pe;_(L),Pe=e.msfix,Math.abs(Pe)>0&&o(L,Pe,e.ATHlower*L.ATH.adjust)}for(h(e,Y,A,D),w=0;w<B;w++){var Ie,Le,He,Ve=0;w>1?(Ie=M,Ve=-2,Le=K.NORM_TYPE,A[0]!=K.SHORT_TYPE&&A[1]!=K.SHORT_TYPE||(Le=K.SHORT_TYPE),He=g[r][w-2]):(Ie=S,Ve=0,Le=A[w],He=v[r][w]),Le==K.SHORT_TYPE?Ie[Ve+w]=b(He,L.masking_lower):Ie[Ve+w]=m(He,L.masking_lower),e.analysis&&(L.pinfo.pe[r][w]=Ie[Ve+w])}return 0};var Se=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_vbr=function(e,t,a,s,n,r,i,_,o,c){var h=e.internal_flags,p=ae(K.HBLKSIZE),d=se([3,K.HBLKSIZE_s]),B=se([2,K.BLKSIZE]),x=se([2,3,K.BLKSIZE_s]),P=se([4,K.CBANDS]),I=se([4,K.CBANDS]),L=se([4,3]),H=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],V=ne(2),N=e.mode==MPEGMode.JOINT_STEREO?4:h.channels_out;for(M(e,t,a,s,n,r,o,L,H,V),T(e,V),G=0;G<N;G++)v(e,t,a,G,s,p,B,O=1&G),S(e,s,G,p),0!=V[O]?E(h,p,P[G],I[G],G):A(h,G);for(V[0]+V[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&k(P,I,h.mld_cb_l,h.ATH.cb_l,e.ATHlower*h.ATH.adjust,e.msfix,h.npart_l),G=0;G<N;G++)0!=V[O=1&G]&&f(h,P[G],I[G],G);for(Y=0;Y<3;Y++){for(G=0;G<N;++G)0!=V[O=1&G]?R(h,G,Y):(g(e,t,a,G,Y,d,x,O),w(e,d,P[G],I[G],G,Y));for(V[0]+V[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&k(P,I,h.mld_cb_s,h.ATH.cb_s,e.ATHlower*h.ATH.adjust,e.msfix,h.npart_s),G=0;G<N;++G)0==V[O=1&G]&&l(h,P[G],I[G],G,Y)}for(G=0;G<N;G++){var O=1&G;if(0==V[O])for(var X=0;X<K.SBMAX_s;X++){for(var D=ae(3),Y=0;Y<3;Y++){var q=h.thm[G].s[X][Y];if(q*=.8,H[G][Y]>=2||1==H[G][Y+1]){var F=0!=Y?Y-1:2,C=u(h.thm[G].s[X][F],q,.36);q=Math.min(q,C)}else if(1==H[G][Y]){var F=0!=Y?Y-1:2,C=u(h.thm[G].s[X][F],q,.6*ie);q=Math.min(q,C)}else if(0!=Y&&3==H[G][Y-1]||0==Y&&3==h.nsPsy.lastAttacks[G]){var F=2!=Y?Y+1:0,C=u(h.thm[G].s[X][F],q,.6*ie);q=Math.min(q,C)}q*=L[G][Y],D[Y]=q}for(Y=0;Y<3;Y++)h.thm[G].s[X][Y]=D[Y]}}for(G=0;G<N;G++)h.nsPsy.lastAttacks[G]=H[G][2];y(e,V,c);for(var G=0;G<N;G++){var j,z,Z,U;G>1?(j=_,z=-2,Z=K.NORM_TYPE,c[0]!=K.SHORT_TYPE&&c[1]!=K.SHORT_TYPE||(Z=K.SHORT_TYPE),U=r[s][G-2]):(j=i,z=0,Z=c[G],U=n[s][G]),Z==K.SHORT_TYPE?j[z+G]=b(U,h.masking_lower):j[z+G]=m(U,h.masking_lower),e.analysis&&(h.pinfo.pe[s][G]=j[z+G])}return 0},this.psymodel_init=function(e){var t,a=e.internal_flags,n=!0,r=13,i=0,_=0,o=-8.25,l=-4.5,f=ae(K.CBANDS),c=ae(K.CBANDS),h=ae(K.CBANDS),u=e.out_samplerate;switch(e.experimentalZ){default:case 0:n=!0;break;case 1:n=e.VBR!=W.vbr_mtrh&&e.VBR!=W.vbr_mt;break;case 2:n=!1;break;case 3:r=8,i=-1.75,_=-.0125,o=-8.25,l=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=K.NORM_TYPE,t=0;t<4;++t){for(m=0;m<K.CBANDS;++m)a.nb_1[t][m]=1e20,a.nb_2[t][m]=1e20,a.nb_s1[t][m]=a.nb_s2[t][m]=1;for(b=0;b<K.SBMAX_l;b++)a.en[t].l[b]=1e20,a.thm[t].l[b]=1e20;for(m=0;m<3;++m){for(var b=0;b<K.SBMAX_s;b++)a.en[t].s[b][m]=1e20,a.thm[t].s[b][m]=1e20;a.nsPsy.lastAttacks[t]=0}for(m=0;m<9;m++)a.nsPsy.last_en_subshort[t][m]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=H(a.numlines_l,a.bo_l,a.bm_l,f,c,a.mld_l,a.PSY.bo_l_weight,u,K.BLKSIZE,a.scalefac_band.l,K.BLKSIZE/1152,K.SBMAX_l),re(a.npart_l<K.CBANDS),t=0;t<a.npart_l;t++)d=i,f[t]>=r&&(d=_*(f[t]-r)/(24-r)+i*(24-f[t])/(24-r)),h[t]=Math.pow(10,d/10),a.numlines_l[t]>0?a.rnumlines_l[t]=1/a.numlines_l[t]:a.rnumlines_l[t]=0;a.s3_ll=V(a.s3ind,a.npart_l,f,c,h,n);var m=0;for(t=0;t<a.npart_l;t++){for(p=J.MAX_VALUE,v=0;v<a.numlines_l[t];v++,m++)S=u*m/(1e3*K.BLKSIZE),g=this.ATHformula(1e3*S,e)-20,g=Math.pow(10,.1*g),p>(g*=a.numlines_l[t])&&(p=g);a.ATH.cb_l[t]=p,(p=20*f[t]/10-20)>6&&(p=100),p<-15&&(p=-15),p-=8,a.minval_l[t]=Math.pow(10,p/10)*a.numlines_l[t]}for(a.npart_s=H(a.numlines_s,a.bo_s,a.bm_s,f,c,a.mld_s,a.PSY.bo_s_weight,u,K.BLKSIZE_s,a.scalefac_band.s,K.BLKSIZE_s/384,K.SBMAX_s),re(a.npart_s<K.CBANDS),m=0,t=0;t<a.npart_s;t++){var p,d=o;f[t]>=r&&(d=l*(f[t]-r)/(24-r)+o*(24-f[t])/(24-r)),h[t]=Math.pow(10,d/10),p=J.MAX_VALUE;for(var v=0;v<a.numlines_s[t];v++,m++){var g,S=u*m/(1e3*K.BLKSIZE_s);g=this.ATHformula(1e3*S,e)-20,g=Math.pow(10,.1*g),p>(g*=a.numlines_s[t])&&(p=g)}a.ATH.cb_s[t]=p,p=7*f[t]/12-7,f[t]>12&&(p*=1+3.1*Math.log(1+p)),f[t]<12&&(p*=1+2.3*Math.log(1-p)),p<-15&&(p=-15),p-=8,a.minval_s[t]=Math.pow(10,p/10)*a.numlines_s[t]}a.s3_ss=V(a.s3ind_s,a.npart_s,f,c,h,n),s(),q.init_fft(a),a.decay=Math.exp(-1*F/(.01*u/192));var M;for(M=3.5,0!=(2&e.exp_nspsytune)&&(M=1),Math.abs(e.msfix)>0&&(M=e.msfix),e.msfix=M,w=0;w<a.npart_l;w++)a.s3ind[w][1]>a.npart_l-1&&(a.s3ind[w][1]=a.npart_l-1);var R=576*a.mode_gr/u;if(a.ATH.decay=Math.pow(10,-1.2*R),a.ATH.adjust=.01,a.ATH.adjustLimit=1,re(a.bo_l[K.SBMAX_l-1]<=a.npart_l),re(a.bo_s[K.SBMAX_s-1]<=a.npart_s),-1!=e.ATHtype){var A=e.out_samplerate/K.BLKSIZE,B=0;for(S=0,t=0;t<K.BLKSIZE/2;++t)S+=A,a.ATH.eql_w[t]=1/Math.pow(10,this.ATHformula(S,e)/10),B+=a.ATH.eql_w[t];for(B=1/B,t=K.BLKSIZE/2;--t>=0;)a.ATH.eql_w[t]*=B}for(w=m=0;w<a.npart_s;++w)for(t=0;t<a.numlines_s[w];++t)++m;re(129==m);for(var w=m=0;w<a.npart_l;++w)for(t=0;t<a.numlines_l[w];++t)++m;for(re(513==m),m=0,t=0;t<a.npart_l;t++)S=u*(m+a.numlines_l[t]/2)/(1*K.BLKSIZE),a.mld_cb_l[t]=N(S),m+=a.numlines_l[t];for(;t<K.CBANDS;++t)a.mld_cb_l[t]=1;for(m=0,t=0;t<a.npart_s;t++)S=u*(m+a.numlines_s[t]/2)/(1*K.BLKSIZE_s),a.mld_cb_s[t]=N(S),m+=a.numlines_s[t];for(;t<K.CBANDS;++t)a.mld_cb_s[t]=1;return 0},this.ATHformula=function(e,t){var a;switch(t.ATHtype){case 0:a=O(e,9);break;case 1:a=O(e,-1);break;case 2:a=O(e,0);break;case 3:a=O(e,1)+6;break;case 4:a=O(e,t.ATHcurve);break;default:a=O(e,0)}return a}};f.STEREO=new f(0),f.JOINT_STEREO=new f(1),f.DUAL_CHANNEL=new f(2),f.MONO=new f(3),f.NOT_SET=new f(4);var _e=f,oe=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=_e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null},le={};le.SFBMAX=3*K.SBMAX_s;var fe=le,ce=k.new_float,he=k.new_int,ue=function(){function e(e){return new Int32Array(e)}function t(e){return new Float32Array(e)}this.xr=ce(576),this.l3_enc=he(576),this.scalefac=he(fe.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=he(3),this.subblock_gain=he(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=he(fe.SFBMAX),this.window=he(fe.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=he(4),this.max_nonzero_coeff=0;var a=this;this.assign=function(s){a.xr=t(s.xr),a.l3_enc=e(s.l3_enc),a.scalefac=e(s.scalefac),a.xrpow_max=s.xrpow_max,a.part2_3_length=s.part2_3_length,a.big_values=s.big_values,a.count1=s.count1,a.global_gain=s.global_gain,a.scalefac_compress=s.scalefac_compress,a.block_type=s.block_type,a.mixed_block_flag=s.mixed_block_flag,a.table_select=e(s.table_select),a.subblock_gain=e(s.subblock_gain),a.region0_count=s.region0_count,a.region1_count=s.region1_count,a.preflag=s.preflag,a.scalefac_scale=s.scalefac_scale,a.count1table_select=s.count1table_select,a.part2_length=s.part2_length,a.sfb_lmax=s.sfb_lmax,a.sfb_smin=s.sfb_smin,a.psy_lmax=s.psy_lmax,a.sfbmax=s.sfbmax,a.psymax=s.psymax,a.sfbdivide=s.sfbdivide,a.width=e(s.width),a.window=e(s.window),a.count1bits=s.count1bits,a.sfb_partition_table=s.sfb_partition_table.slice(0),a.slen=e(s.slen),a.max_nonzero_coeff=s.max_nonzero_coeff}},be=k.new_int,me=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[be(4),be(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new ue},pe=k.System,de=k.new_int,ve=function(e,t,a,s){this.l=de(1+K.SBMAX_l),this.s=de(1+K.SBMAX_s),this.psfb21=de(1+K.PSFB21),this.psfb12=de(1+K.PSFB12);var n=this.l,r=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],pe.arraycopy(this.arrL,0,n,0,Math.min(this.arrL.length,this.l.length)),pe.arraycopy(this.arrS,0,r,0,Math.min(this.arrS.length,this.s.length)),pe.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),pe.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},ge=k.new_float,Se=k.new_float_n,Me=k.new_int,Re=function(){this.last_en_subshort=Se([4,9]),this.lastAttacks=Me(4),this.pefirbuf=ge(19),this.longfact=ge(K.SBMAX_l),this.shortfact=ge(K.SBMAX_s),this.attackthre=0,this.attackthre_s=0},Ae=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},Be=k.new_byte,we=k.new_double,Ee=k.new_float,Te=k.new_float_n,ye=k.new_int,ke=k.new_int_n;c.MFSIZE=3456+K.ENCDELAY-K.MDCTDELAY,c.MAX_HEADER_BUF=256,c.MAX_BITS_PER_CHANNEL=4095,c.MAX_BITS_PER_GRANULE=7680,c.BPC=320;var xe=c,Pe=k.new_float,Ie=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Pe(K.SBMAX_l),this.s=Pe(K.SBMAX_s),this.psfb21=Pe(K.PSFB21),this.psfb12=Pe(K.PSFB12),this.cb_l=Pe(K.CBANDS),this.cb_s=Pe(K.CBANDS),this.eql_w=Pe(K.BLKSIZE/2)},Le=k.System,He=k.Arrays;h.STEPS_per_dB=100,h.MAX_dB=120,h.GAIN_NOT_ENOUGH_SAMPLES=-24601,h.GAIN_ANALYSIS_ERROR=0,h.GAIN_ANALYSIS_OK=1,h.INIT_GAIN_ANALYSIS_ERROR=0,h.INIT_GAIN_ANALYSIS_OK=1,h.YULE_ORDER=10,h.MAX_ORDER=h.YULE_ORDER,h.MAX_SAMP_FREQ=48e3,h.RMS_WINDOW_TIME_NUMERATOR=1,h.RMS_WINDOW_TIME_DENOMINATOR=20,h.MAX_SAMPLES_PER_WINDOW=h.MAX_SAMP_FREQ*h.RMS_WINDOW_TIME_NUMERATOR/h.RMS_WINDOW_TIME_DENOMINATOR+1;var Ve=h,Ne=k.new_float,Oe=k.new_int,Xe=function(){this.linprebuf=Ne(2*Ve.MAX_ORDER),this.linpre=0,this.lstepbuf=Ne(Ve.MAX_SAMPLES_PER_WINDOW+Ve.MAX_ORDER),this.lstep=0,this.loutbuf=Ne(Ve.MAX_SAMPLES_PER_WINDOW+Ve.MAX_ORDER),this.lout=0,this.rinprebuf=Ne(2*Ve.MAX_ORDER),this.rinpre=0,this.rstepbuf=Ne(Ve.MAX_SAMPLES_PER_WINDOW+Ve.MAX_ORDER),this.rstep=0,this.routbuf=Ne(Ve.MAX_SAMPLES_PER_WINDOW+Ve.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Oe(0|Ve.STEPS_per_dB*Ve.MAX_dB),this.B=Oe(0|Ve.STEPS_per_dB*Ve.MAX_dB)},De=function(e){this.bits=e},Ye=k.new_float,qe=k.new_int,Fe=k.assert,Ce=function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,a,s){var n,r=e.internal_flags,i=Ye(fe.SFBMAX),_=Ye(576),o=qe(2),l=0,f=r.l3_side,c=new De(l);this.quantize.rv.ResvFrameBegin(e,c),l=c.bits;for(var h=0;h<r.mode_gr;h++){n=this.quantize.qupvt.on_pe(e,t,o,l,h,h),r.mode_ext==K.MPG_MD_MS_LR&&(this.quantize.ms_convert(r.l3_side,h),this.quantize.qupvt.reduce_side(o,a[h],l,n));for(var u=0;u<r.channels_out;u++){var b,m,p=f.tt[h][u];p.block_type!=K.SHORT_TYPE?(b=0,m=r.PSY.mask_adjust-b):(b=0,m=r.PSY.mask_adjust_short-b),r.masking_lower=Math.pow(10,.1*m),this.quantize.init_outer_loop(r,p),this.quantize.init_xrpow(r,p,_)&&(this.quantize.qupvt.calc_xmin(e,s[h][u],p,i),this.quantize.outer_loop(e,p,i,_,u,o[u])),this.quantize.iteration_finish_one(r,h,u),Fe(p.part2_3_length<=xe.MAX_BITS_PER_CHANNEL),Fe(p.part2_3_length<=o[u])}}this.quantize.rv.ResvFrameEnd(r,l)}},Ge={};Ge.t1HB=[1,1,1,0],Ge.t2HB=[1,2,1,3,1,1,3,2,0],Ge.t3HB=[3,2,1,1,1,1,3,2,0],Ge.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],Ge.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],Ge.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],Ge.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],Ge.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],Ge.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],Ge.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],Ge.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],Ge.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],Ge.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],Ge.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],Ge.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],Ge.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],Ge.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],Ge.t1l=[1,4,3,5],Ge.t2l=[1,4,7,4,5,7,6,7,8],Ge.t3l=[2,3,7,4,4,7,6,7,8],Ge.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],Ge.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],Ge.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],Ge.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],Ge.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],Ge.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],Ge.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],Ge.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],Ge.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],Ge.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],Ge.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],Ge.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],Ge.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],Ge.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],Ge.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],Ge.ht=[new u(0,0,null,null),new u(2,0,Ge.t1HB,Ge.t1l),new u(3,0,Ge.t2HB,Ge.t2l),new u(3,0,Ge.t3HB,Ge.t3l),new u(0,0,null,null),new u(4,0,Ge.t5HB,Ge.t5l),new u(4,0,Ge.t6HB,Ge.t6l),new u(6,0,Ge.t7HB,Ge.t7l),new u(6,0,Ge.t8HB,Ge.t8l),new u(6,0,Ge.t9HB,Ge.t9l),new u(8,0,Ge.t10HB,Ge.t10l),new u(8,0,Ge.t11HB,Ge.t11l),new u(8,0,Ge.t12HB,Ge.t12l),new u(16,0,Ge.t13HB,Ge.t13l),new u(0,0,null,Ge.t16_5l),new u(16,0,Ge.t15HB,Ge.t15l),new u(1,1,Ge.t16HB,Ge.t16l),new u(2,3,Ge.t16HB,Ge.t16l),new u(3,7,Ge.t16HB,Ge.t16l),new u(4,15,Ge.t16HB,Ge.t16l),new u(6,63,Ge.t16HB,Ge.t16l),new u(8,255,Ge.t16HB,Ge.t16l),new u(10,1023,Ge.t16HB,Ge.t16l),new u(13,8191,Ge.t16HB,Ge.t16l),new u(4,15,Ge.t24HB,Ge.t24l),new u(5,31,Ge.t24HB,Ge.t24l),new u(6,63,Ge.t24HB,Ge.t24l),new u(7,127,Ge.t24HB,Ge.t24l),new u(8,255,Ge.t24HB,Ge.t24l),new u(9,511,Ge.t24HB,Ge.t24l),new u(11,2047,Ge.t24HB,Ge.t24l),new u(13,8191,Ge.t24HB,Ge.t24l),new u(0,0,Ge.t32HB,Ge.t32l),new u(0,0,Ge.t33HB,Ge.t33l)],Ge.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],Ge.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],Ge.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],Ge.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],Ge.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],Ge.scfsi_band=[0,6,11,16,21];var je=Ge,ze=k.VbrMode,Ke=k.Float,Ze=k.Util,Ue=k.new_float,Qe=k.new_int,We=k.assert;b.Q_MAX=257,b.Q_MAX2=116,b.LARGE_BITS=1e5,b.IXMAX_VAL=8206;var Je=b,$e=k.System,et=k.Arrays,tt=k.new_int,at=k.assert,st=m,nt=k.System,rt=k.Arrays,it=k.new_byte,_t=k.new_float_n,ot=k.new_int,lt=k.assert;p.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},p.NEQ=function(e,t){return!p.EQ(e,t)};var ft=p,ct=k.System,ht=k.VbrMode,ut=k.ShortBlock,bt=k.new_float,mt=k.new_int_n,pt=k.new_short_n,dt=k.assert,vt=d,gt=k.VbrMode,St=function(){var e,t;this.setModules=function(a,s){e=a,t=s}},Mt=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0},Rt=k.new_float,At=k.new_int,Bt=function(){this.global_gain=0,this.sfb_count1=0,this.step=At(39),this.noise=Rt(39),this.noise_log=Rt(39)},wt=k.System,Et=k.VbrMode,Tt=k.Util,yt=k.Arrays,kt=k.new_float,xt=k.assert,Pt=k.assert,It=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},Lt=k.System,Ht=k.VbrMode,Vt=k.ShortBlock,Nt=k.Arrays,Ot=k.new_byte,Xt=k.assert;v.NUMTOCENTRIES=100,v.MAXFRAMESIZE=2880;var Dt=v,Yt=k.new_byte,qt=k.assert;Lame=vt,Presets=function(){function e(e,t,a,s,n,r,i,_,o,l,f,c,h,u,b){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=a,this.expY=s,this.st_lrm=n,this.st_s=r,this.masking_adj=i,this.masking_adj_short=_,this.ath_lower=o,this.ath_curve=l,this.ath_sensitivity=f,this.interch=c,this.safejoint=h,this.sfb21mod=u,this.msfix=b}function t(e,t,a,s,n,r,i,_,o,l,f,c,h,u){this.quant_comp=t,this.quant_comp_s=a,this.safejoint=s,this.nsmsfix=n,this.st_lrm=r,this.st_s=i,this.nsbass=_,this.scale=o,this.masking_adj=l,this.ath_lower=f,this.ath_curve=c,this.interch=h,this.sfscale=u}function a(e,t,a){var s=e.VBR==gt.vbr_rh?i:_,r=e.VBR_q_frac,o=s[t],l=s[t+1],f=o;o.st_lrm=o.st_lrm+r*(l.st_lrm-o.st_lrm),o.st_s=o.st_s+r*(l.st_s-o.st_s),o.masking_adj=o.masking_adj+r*(l.masking_adj-o.masking_adj),o.masking_adj_short=o.masking_adj_short+r*(l.masking_adj_short-o.masking_adj_short),o.ath_lower=o.ath_lower+r*(l.ath_lower-o.ath_lower),o.ath_curve=o.ath_curve+r*(l.ath_curve-o.ath_curve),o.ath_sensitivity=o.ath_sensitivity+r*(l.ath_sensitivity-o.ath_sensitivity),o.interch=o.interch+r*(l.interch-o.interch),o.msfix=o.msfix+r*(l.msfix-o.msfix),n(e,f.vbr_q),0!=a?e.quant_comp=f.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=f.quant_comp),0!=a?e.quant_comp_short=f.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=f.quant_comp_s),0!=f.expY&&(e.experimentalY=0!=f.expY),0!=a?e.internal_flags.nsPsy.attackthre=f.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=f.st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=f.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=f.st_s),0!=a?e.maskingadjust=f.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=f.masking_adj),0!=a?e.maskingadjust_short=f.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=f.masking_adj_short),0!=a?e.ATHlower=-f.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-f.ath_lower/10),0!=a?e.ATHcurve=f.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=f.ath_curve),0!=a?e.athaa_sensitivity=f.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=f.ath_sensitivity),f.interch>0&&(0!=a?e.interChRatio=f.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=f.interch)),f.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|f.safejoint),f.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|f.sfb21mod<<20),0!=a?e.msfix=f.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=f.msfix),0==a&&(e.VBR_q=t,e.VBR_q_frac=r)}function s(e,t,a){var s=t,n=r.nearestBitrateFullIndex(t);if(e.VBR=gt.vbr_abr,e.VBR_mean_bitrate_kbps=s,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[n].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[n].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[n].nsbass)>0){var i=int(4*o[n].nsbass);i<0&&(i+=64),e.exp_nspsytune=e.exp_nspsytune|i<<2}return 0!=a?e.quant_comp=o[n].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[n].quant_comp),0!=a?e.quant_comp_short=o[n].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[n].quant_comp_s),0!=a?e.msfix=o[n].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[n].nsmsfix),0!=a?e.internal_flags.nsPsy.attackthre=o[n].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[n].st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=o[n].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[n].st_s),0!=a?e.scale=o[n].scale:Math.abs(e.scale- -1)>0||(e.scale=o[n].scale),0!=a?e.maskingadjust=o[n].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[n].masking_adj),o[n].masking_adj>0?0!=a?e.maskingadjust_short=.9*o[n].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[n].masking_adj):0!=a?e.maskingadjust_short=1.1*o[n].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[n].masking_adj),0!=a?e.ATHlower=-o[n].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[n].ath_lower/10),0!=a?e.ATHcurve=o[n].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[n].ath_curve),0!=a?e.interChRatio=o[n].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[n].interch),t}function n(e,t){var a=0;return 0>t&&(a=-1,t=0),9<t&&(a=-1,t=9),e.VBR_q=t,e.VBR_q_frac=0,a}var r;this.setModules=function(e){r=e};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],_=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)],o=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(e,t,n){switch(t){case Lame.R3MIX:t=Lame.V3,e.VBR=gt.vbr_mtrh;break;case Lame.MEDIUM:t=Lame.V4,e.VBR=gt.vbr_rh;break;case Lame.MEDIUM_FAST:t=Lame.V4,e.VBR=gt.vbr_mtrh;break;case Lame.STANDARD:t=Lame.V2,e.VBR=gt.vbr_rh;break;case Lame.STANDARD_FAST:t=Lame.V2,e.VBR=gt.vbr_mtrh;break;case Lame.EXTREME:t=Lame.V0,e.VBR=gt.vbr_rh;break;case Lame.EXTREME_FAST:t=Lame.V0,e.VBR=gt.vbr_mtrh;break;case Lame.INSANE:return t=320,e.preset=t,s(e,t,n),e.VBR=gt.vbr_off,t}switch(e.preset=t,t){case Lame.V9:return a(e,9,n),t;case Lame.V8:return a(e,8,n),t;case Lame.V7:return a(e,7,n),t;case Lame.V6:return a(e,6,n),t;case Lame.V5:return a(e,5,n),t;case Lame.V4:return a(e,4,n),t;case Lame.V3:return a(e,3,n),t;case Lame.V2:return a(e,2,n),t;case Lame.V1:return a(e,1,n),t;case Lame.V0:return a(e,0,n),t}return 8<=t&&t<=320?s(e,t,n):(e.preset=0,t)}},GainAnalysis=Ve,QuantizePVT=Je,Quantize=function(){function e(e,t,a,s){s=0;for(var n=0;n<=a;++n){var r=Math.abs(e.xr[n]);s+=r,t[n]=Math.sqrt(r*Math.sqrt(r)),t[n]>e.xrpow_max&&(e.xrpow_max=t[n])}return s}function t(e,t){var a=e.ATH,s=t.xr;if(t.block_type!=K.SHORT_TYPE)for(var n=!1,r=K.PSFB21-1;r>=0&&!n;r--){var i=e.scalefac_band.psfb21[r],_=e.scalefac_band.psfb21[r+1],o=b.athAdjust(a.adjust,a.psfb21[r],a.floor);for(e.nsPsy.longfact[21]>1e-12&&(o*=e.nsPsy.longfact[21]),c=_-1;c>=i;c--){if(!(Math.abs(s[c])<o)){n=!0;break}s[c]=0}}else for(var l=0;l<3;l++)for(var n=!1,r=K.PSFB12-1;r>=0&&!n;r--){var _=(i=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*l+(e.scalefac_band.psfb12[r]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[r+1]-e.scalefac_band.psfb12[r]),f=b.athAdjust(a.adjust,a.psfb12[r],a.floor);e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]);for(var c=_-1;c>=i;c--){if(!(Math.abs(s[c])<f)){n=!0;break}s[c]=0}}}function a(e){this.ordinal=e}function s(e,t,s,n,r){var i,_=e.CurrentStep[n],o=!1,l=e.OldValue[n],f=a.BINSEARCH_NONE;for(t.global_gain=l,s-=t.part2_length,xt(0!=_);;){var c;if(i=m.count_bits(e,r,t,null),1==_||i==s)break;i>s?(f==a.BINSEARCH_DOWN&&(o=!0),o&&(_/=2),f=a.BINSEARCH_UP,c=_):(f==a.BINSEARCH_UP&&(o=!0),o&&(_/=2),f=a.BINSEARCH_DOWN,c=-_),t.global_gain+=c,t.global_gain<0&&(t.global_gain=0,o=!0),t.global_gain>255&&(t.global_gain=255,o=!0)}for(xt(t.global_gain>=0),xt(t.global_gain<256);i>s&&t.global_gain<255;)t.global_gain++,i=m.count_bits(e,r,t,null);return e.CurrentStep[n]=l-t.global_gain>=4?4:2,e.OldValue[n]=t.global_gain,t.part2_3_length=i,i}function n(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function r(e){return Tt.FAST_LOG10(.368+.632*e*e*e)}function i(e,t){for(var a=1e-37,s=0;s<t.psymax;s++)a+=r(e[s]);return Math.max(1e-20,a)}function _(e,t,a,s,n){var r;switch(e){default:case 9:t.over_count>0?(r=a.over_SSD<=t.over_SSD,a.over_SSD==t.over_SSD&&(r=a.bits<t.bits)):r=a.max_noise<0&&10*a.max_noise+a.bits<=10*t.max_noise+t.bits;break;case 0:r=a.over_count<t.over_count||a.over_count==t.over_count&&a.over_noise<t.over_noise||a.over_count==t.over_count&&BitStream.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 8:a.max_noise=i(n,s);case 1:r=a.max_noise<t.max_noise;break;case 2:r=a.tot_noise<t.tot_noise;break;case 3:r=a.tot_noise<t.tot_noise&&a.max_noise<t.max_noise;break;case 4:r=a.max_noise<=0&&t.max_noise>.2||a.max_noise<=0&&t.max_noise<0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise||a.max_noise<=0&&t.max_noise>0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise+t.over_noise||a.max_noise>0&&t.max_noise>-.05&&t.max_noise>a.max_noise-.1&&a.tot_noise+a.over_noise<t.tot_noise+t.over_noise||a.max_noise>0&&t.max_noise>-.1&&t.max_noise>a.max_noise-.15&&a.tot_noise+a.over_noise+a.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:r=a.over_noise<t.over_noise||BitStream.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 6:r=a.over_noise<t.over_noise||BitStream.EQ(a.over_noise,t.over_noise)&&(a.max_noise<t.max_noise||BitStream.EQ(a.max_noise,t.max_noise)&&a.tot_noise<=t.tot_noise);break;case 7:r=a.over_count<t.over_count||a.over_noise<t.over_noise}return 0==t.over_count&&(r=r&&a.bits<t.bits),r}function o(e,t,a,s,n){var r,i=e.internal_flags;r=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var _=0,o=0;o<t.sfbmax;o++)_<a[o]&&(_=a[o]);var l=i.noise_shaping_amp;switch(3==l&&(l=n?2:1),l){case 2:break;case 1:_>1?_=Math.pow(_,.5):_*=.95;break;case 0:default:_>1?_=1:_*=.95}for(var f=0,o=0;o<t.sfbmax;o++){var c,h=t.width[o];if(f+=h,!(a[o]<_)){if(0!=(2&i.substep_shaping)&&(i.pseudohalf[o]=0==i.pseudohalf[o]?1:0,0==i.pseudohalf[o]&&2==i.noise_shaping_amp))return;for(t.scalefac[o]++,c=-h;c<0;c++)s[f+c]*=r,s[f+c]>t.xrpow_max&&(t.xrpow_max=s[f+c]);if(2==i.noise_shaping_amp)return}}}function l(e,t){for(var a=0,s=0;s<e.sfbmax;s++){var n=e.width[s],r=e.scalefac[s];if(0!=e.preflag&&(r+=b.pretab[s]),a+=n,0!=(1&r)){r++;for(var i=-n;i<0;i++)t[a+i]*=1.2968395546510096,t[a+i]>e.xrpow_max&&(e.xrpow_max=t[a+i])}e.scalefac[s]=r>>1}e.preflag=0,e.scalefac_scale=1}function f(e,t,a){var s,n=t.scalefac;for(s=0;s<t.sfb_lmax;s++)if(n[s]>=16)return!0;for(var r=0;r<3;r++){var i=0,_=0;for(s=t.sfb_lmax+r;s<t.sfbdivide;s+=3)i<n[s]&&(i=n[s]);for(;s<t.sfbmax;s+=3)_<n[s]&&(_=n[s]);if(!(i<16&&_<8)){if(t.subblock_gain[r]>=7)return!0;t.subblock_gain[r]++;var o=e.scalefac_band.l[t.sfb_lmax];for(s=t.sfb_lmax+r;s<t.sfbmax;s+=3){var l=t.width[s],f=n[s];if(xt(f>=0),(f-=4>>t.scalefac_scale)>=0)n[s]=f,o+=3*l;else{n[s]=0;var c=210+(f<<t.scalefac_scale+1);for(h=b.IPOW20(c),o+=l*(r+1),u=-l;u<0;u++)a[o+u]*=h,a[o+u]>t.xrpow_max&&(t.xrpow_max=a[o+u]);o+=l*(3-r-1)}}var h=b.IPOW20(202);o+=t.width[s]*(r+1);for(var u=-t.width[s];u<0;u++)a[o+u]*=h,a[o+u]>t.xrpow_max&&(t.xrpow_max=a[o+u])}}return!1}function c(e,t,a,s,r){var i=e.internal_flags;o(e,t,a,s,r);var _=n(t);return!(_||(_=2==i.mode_gr?m.scale_bitcount(t):m.scale_bitcount_lsf(i,t))&&(i.noise_shaping>1&&(yt.fill(i.pseudohalf,0),0==t.scalefac_scale?(l(t,s),_=!1):t.block_type==K.SHORT_TYPE&&i.subblock_gain>0&&(_=f(i,t,s)||n(t))),_||(_=2==i.mode_gr?m.scale_bitcount(t):m.scale_bitcount_lsf(i,t)),_))}var h;this.rv=null;var u;this.qupvt=null;var b,m,p=new St;this.setModules=function(e,t,a,s){h=e,u=t,this.rv=t,b=a,this.qupvt=a,m=s,p.setModules(b,m)},this.ms_convert=function(e,t){for(var a=0;a<576;++a){var s=e.tt[t][0].xr[a],n=e.tt[t][1].xr[a];e.tt[t][0].xr[a]=(s+n)*(.5*Tt.SQRT2),e.tt[t][1].xr[a]=(s-n)*(.5*Tt.SQRT2)}},this.init_xrpow=function(t,a,s){var n=0,r=0|a.max_nonzero_coeff;if(xt(null!=s),a.xrpow_max=0,xt(0<=r&&r<=575),yt.fill(s,r,576,0),(n=e(a,s,r,n))>1e-20){var i=0;0!=(2&t.substep_shaping)&&(i=1);for(var _=0;_<a.psymax;_++)t.pseudohalf[_]=i;return!0}return yt.fill(a.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,a){for(a.part2_3_length=0,a.big_values=0,a.count1=0,a.global_gain=210,a.scalefac_compress=0,a.table_select[0]=0,a.table_select[1]=0,a.table_select[2]=0,a.subblock_gain[0]=0,a.subblock_gain[1]=0,a.subblock_gain[2]=0,a.subblock_gain[3]=0,a.region0_count=0,a.region1_count=0,a.preflag=0,a.scalefac_scale=0,a.count1table_select=0,a.part2_length=0,a.sfb_lmax=K.SBPSY_l,a.sfb_smin=K.SBPSY_s,a.psy_lmax=e.sfb21_extra?K.SBMAX_l:K.SBPSY_l,a.psymax=a.psy_lmax,a.sfbmax=a.sfb_lmax,a.sfbdivide=11,f=0;f<K.SBMAX_l;f++)a.width[f]=e.scalefac_band.l[f+1]-e.scalefac_band.l[f],a.window[f]=3;if(a.block_type==K.SHORT_TYPE){var s=kt(576);a.sfb_smin=0,a.sfb_lmax=0,0!=a.mixed_block_flag&&(a.sfb_smin=3,a.sfb_lmax=2*e.mode_gr+4),a.psymax=a.sfb_lmax+3*((e.sfb21_extra?K.SBMAX_s:K.SBPSY_s)-a.sfb_smin),a.sfbmax=a.sfb_lmax+3*(K.SBPSY_s-a.sfb_smin),a.sfbdivide=a.sfbmax-18,a.psy_lmax=a.sfb_lmax;var n=e.scalefac_band.l[a.sfb_lmax];for(wt.arraycopy(a.xr,0,s,0,576),f=a.sfb_smin;f<K.SBMAX_s;f++)for(var r=e.scalefac_band.s[f],i=e.scalefac_band.s[f+1],_=0;_<3;_++)for(var o=r;o<i;o++)a.xr[n++]=s[3*o+_];for(var l=a.sfb_lmax,f=a.sfb_smin;f<K.SBMAX_s;f++)a.width[l]=a.width[l+1]=a.width[l+2]=e.scalefac_band.s[f+1]-e.scalefac_band.s[f],a.window[l]=0,a.window[l+1]=1,a.window[l+2]=2,l+=3}a.count1bits=0,a.sfb_partition_table=b.nr_of_sfb_block[0][0],a.slen[0]=0,a.slen[1]=0,a.slen[2]=0,a.slen[3]=0,a.max_nonzero_coeff=575,yt.fill(a.scalefac,0),t(e,a)},a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2),this.trancate_smallspectrums=function(e,t,a,s){var n=kt(fe.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=K.SHORT_TYPE)&&0==(128&e.substep_shaping)){for(b.calc_noise(t,a,n,new Mt,null),i=0;i<576;i++){var r=0;0!=t.l3_enc[i]&&(r=Math.abs(t.xr[i])),s[i]=r}var i=0,_=8;t.block_type==K.SHORT_TYPE&&(_=6);do{var o,l,f,c,h=t.width[_];if(i+=h,!(n[_]>=1||(yt.sort(s,i-h,h),BitStream.EQ(s[i-1],0)))){o=(1-n[_])*a[_],l=0,c=0;do{var u;for(f=1;c+f<h&&!BitStream.NEQ(s[c+i-h],s[c+i+f-h]);f++);if(u=s[c+i-h]*s[c+i-h]*f,o<u){0!=c&&(l=s[c+i-h-1]);break}o-=u,c+=f}while(c<h);if(!BitStream.EQ(l,0))do{Math.abs(t.xr[i-h])<=l&&(t.l3_enc[i-h]=0)}while(--h>0)}}while(++_<t.psymax);t.part2_3_length=m.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,a,n,r,i){var o,l=e.internal_flags,f=new ue,h=kt(576),u=kt(fe.SFBMAX),p=new Mt,d=new Bt,v=9999999,g=!1,S=!1,M=0;if(s(l,t,i,r,n),0==l.noise_shaping)return 100;b.calc_noise(t,a,u,p,d),p.bits=t.part2_3_length,f.assign(t);var R=0;for(wt.arraycopy(n,0,h,0,576);!g;){do{var A,B=new Mt,w=255;if(A=0!=(2&l.substep_shaping)?20:3,l.sfb21_extra){if(u[f.sfbmax]>1)break;if(f.block_type==K.SHORT_TYPE&&(u[f.sfbmax+1]>1||u[f.sfbmax+2]>1))break}if(!c(e,f,u,n,S))break;0!=f.scalefac_scale&&(w=254);var E=i-f.part2_length;if(E<=0)break;for(;(f.part2_3_length=m.count_bits(l,n,f,d))>E&&f.global_gain<=w;)f.global_gain++;if(f.global_gain>w)break;if(0==p.over_count){for(;(f.part2_3_length=m.count_bits(l,n,f,d))>v&&f.global_gain<=w;)f.global_gain++;if(f.global_gain>w)break}if(b.calc_noise(f,a,u,B,d),B.bits=f.part2_3_length,o=t.block_type!=K.SHORT_TYPE?e.quant_comp:e.quant_comp_short,0!=(o=_(o,p,B,f,u)?1:0))v=t.part2_3_length,p=B,t.assign(f),R=0,wt.arraycopy(n,0,h,0,576);else if(0==l.full_outer_loop){if(++R>A&&0==p.over_count)break;if(3==l.noise_shaping_amp&&S&&R>30)break;if(3==l.noise_shaping_amp&&S&&f.global_gain-M>15)break}}while(f.global_gain+f.scalefac_scale<255);3==l.noise_shaping_amp?S?g=!0:(f.assign(t),wt.arraycopy(h,0,n,0,576),R=0,M=f.global_gain,S=!0):g=!0}return xt(t.global_gain+t.scalefac_scale<=255),e.VBR==Et.vbr_rh||e.VBR==Et.vbr_mtrh?wt.arraycopy(h,0,n,0,576):0!=(1&l.substep_shaping)&&trancate_smallspectrums(l,t,a,n),p.over_count},this.iteration_finish_one=function(e,t,a){var s=e.l3_side,n=s.tt[t][a];m.best_scalefac_store(e,t,a,s),1==e.use_best_huffman&&m.best_huffman_divide(e,n),u.ResvAdjust(e,n)},this.VBR_encode_granule=function(e,t,a,s,n,r,i){var _,o=e.internal_flags,l=new ue,f=kt(576),c=i,h=i+1,u=(i+r)/2,b=0,m=o.sfb21_extra;xt(c<=LameInternalFlags.MAX_BITS_PER_CHANNEL),yt.fill(l.l3_enc,0);do{xt(u>=r),xt(u<=i),xt(r<=i),o.sfb21_extra=!(u>c-42)&&m,outer_loop(e,t,a,s,n,u)<=0?(b=1,h=t.part2_3_length,l.assign(t),wt.arraycopy(s,0,f,0,576),_=(i=h-32)-r,u=(i+r)/2):(_=i-(r=u+32),u=(i+r)/2,0!=b&&(b=2,t.assign(l),wt.arraycopy(f,0,s,0,576)))}while(_>12);o.sfb21_extra=m,2==b&&wt.arraycopy(l.l3_enc,0,t.l3_enc,0,576),xt(t.part2_3_length<=c)},this.get_framebits=function(e,t){var a=e.internal_flags;a.bitrate_index=a.VBR_min_bitrate;var s=h.getframebits(e);a.bitrate_index=1,s=h.getframebits(e);for(var n=1;n<=a.VBR_max_bitrate;n++){a.bitrate_index=n;var r=new MeanBits(s);t[n]=u.ResvFrameBegin(e,r),s=r.bits}},this.VBR_old_prepare=function(e,t,a,s,n,r,i,_,o){var l,f=e.internal_flags,c=0,h=1,m=0;f.bitrate_index=f.VBR_max_bitrate;var p=u.ResvFrameBegin(e,new MeanBits(0))/f.mode_gr;for(get_framebits(e,r),g=0;g<f.mode_gr;g++){var d=b.on_pe(e,t,_[g],p,g,0);for(f.mode_ext==K.MPG_MD_MS_LR&&(ms_convert(f.l3_side,g),b.reduce_side(_[g],a[g],p,d)),S=0;S<f.channels_out;++S){var v=f.l3_side.tt[g][S];v.block_type!=K.SHORT_TYPE?(c=1.28/(1+Math.exp(3.5-t[g][S]/300))-.05,l=f.PSY.mask_adjust-c):(c=2.56/(1+Math.exp(3.5-t[g][S]/300))-.14,l=f.PSY.mask_adjust_short-c),f.masking_lower=Math.pow(10,.1*l),init_outer_loop(f,v),o[g][S]=b.calc_xmin(e,s[g][S],v,n[g][S]),0!=o[g][S]&&(h=0),i[g][S]=126,m+=_[g][S]}}for(var g=0;g<f.mode_gr;g++)for(var S=0;S<f.channels_out;S++)m>r[f.VBR_max_bitrate]&&(_[g][S]*=r[f.VBR_max_bitrate],_[g][S]/=m),i[g][S]>_[g][S]&&(i[g][S]=_[g][S]);return h},this.bitpressure_strategy=function(e,t,a,s){for(var n=0;n<e.mode_gr;n++)for(var r=0;r<e.channels_out;r++){for(var i=e.l3_side.tt[n][r],_=t[n][r],o=0,l=0;l<i.psy_lmax;l++)_[o++]*=1+.029*l*l/K.SBMAX_l/K.SBMAX_l;if(i.block_type==K.SHORT_TYPE)for(l=i.sfb_smin;l<K.SBMAX_s;l++)_[o++]*=1+.029*l*l/K.SBMAX_s/K.SBMAX_s,_[o++]*=1+.029*l*l/K.SBMAX_s/K.SBMAX_s,_[o++]*=1+.029*l*l/K.SBMAX_s/K.SBMAX_s;s[n][r]=0|Math.max(a[n][r],.9*s[n][r])}},this.VBR_new_prepare=function(e,t,a,s,n,r){var i,_=e.internal_flags,o=1,l=0,f=0;if(e.free_format)_.bitrate_index=0,c=new MeanBits(l),i=u.ResvFrameBegin(e,c),l=c.bits,n[0]=i;else{_.bitrate_index=_.VBR_max_bitrate;var c=new MeanBits(l);u.ResvFrameBegin(e,c),l=c.bits,get_framebits(e,n),i=n[_.VBR_max_bitrate]}for(m=0;m<_.mode_gr;m++)for(b.on_pe(e,t,r[m],l,m,0),_.mode_ext==K.MPG_MD_MS_LR&&ms_convert(_.l3_side,m),p=0;p<_.channels_out;++p){var h=_.l3_side.tt[m][p];_.masking_lower=Math.pow(10,.1*_.PSY.mask_adjust),init_outer_loop(_,h),0!=b.calc_xmin(e,a[m][p],h,s[m][p])&&(o=0),f+=r[m][p]}for(var m=0;m<_.mode_gr;m++)for(var p=0;p<_.channels_out;p++)f>i&&(r[m][p]*=i,r[m][p]/=f);return o},this.calc_target_bits=function(e,t,a,s,n,r){var i,_,o,l,f=e.internal_flags,c=f.l3_side,m=0;f.bitrate_index=f.VBR_max_bitrate;var p=new MeanBits(m);for(r[0]=u.ResvFrameBegin(e,p),m=p.bits,f.bitrate_index=1,m=h.getframebits(e)-8*f.sideinfo_len,n[0]=m/(f.mode_gr*f.channels_out),m=e.VBR_mean_bitrate_kbps*e.framesize*1e3,0!=(1&f.substep_shaping)&&(m*=1.09),m/=e.out_samplerate,m-=8*f.sideinfo_len,m/=f.mode_gr*f.channels_out,(i=.93+.07*(11-e.compression_ratio)/5.5)<.9&&(i=.9),i>1&&(i=1),_=0;_<f.mode_gr;_++){var d=0;for(o=0;o<f.channels_out;o++){if(s[_][o]=int(i*m),t[_][o]>700){var v=int((t[_][o]-700)/1.4),g=c.tt[_][o];s[_][o]=int(i*m),g.block_type==K.SHORT_TYPE&&v<m/2&&(v=m/2),v>3*m/2?v=3*m/2:v<0&&(v=0),s[_][o]+=v}s[_][o]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(s[_][o]=LameInternalFlags.MAX_BITS_PER_CHANNEL),d+=s[_][o]}if(d>LameInternalFlags.MAX_BITS_PER_GRANULE)for(o=0;o<f.channels_out;++o)s[_][o]*=LameInternalFlags.MAX_BITS_PER_GRANULE,s[_][o]/=d}if(f.mode_ext==K.MPG_MD_MS_LR)for(_=0;_<f.mode_gr;_++)b.reduce_side(s[_],a[_],m*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(l=0,_=0;_<f.mode_gr;_++)for(o=0;o<f.channels_out;o++)s[_][o]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(s[_][o]=LameInternalFlags.MAX_BITS_PER_CHANNEL),l+=s[_][o];if(l>r[0])for(_=0;_<f.mode_gr;_++)for(o=0;o<f.channels_out;o++)s[_][o]*=r[0],s[_][o]/=l}},Takehiro=st,Reservoir=function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var s,n=t.internal_flags,r=n.l3_side,i=e.getframebits(t);a.bits=(i-8*n.sideinfo_len)/n.mode_gr;var _=2048*n.mode_gr-8;t.brate>320?s=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(s=11520,t.strict_ISO&&(s=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=s-i,n.ResvMax>_&&(n.ResvMax=_),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var o=a.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return o>s&&(o=s),Pt(0==n.ResvMax%8),Pt(n.ResvMax>=0),r.resvDrain_pre=0,null!=n.pinfo&&(n.pinfo.mean_bits=a.bits/2,n.pinfo.resvsize=n.ResvSize),o},this.ResvMaxBits=function(e,t,a,s){var n,r=e.internal_flags,i=r.ResvSize,_=r.ResvMax;0!=s&&(i+=t),0!=(1&r.substep_shaping)&&(_*=.9),a.bits=t,10*i>9*_?(n=i-9*_/10,a.bits+=n,r.substep_shaping|=128):(n=0,r.substep_shaping&=127,e.disable_reservoir||0!=(1&r.substep_shaping)||(a.bits-=.1*t));var o=i<6*r.ResvMax/10?i:6*r.ResvMax/10;return(o-=n)<0&&(o=0),o},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var a,s=e.l3_side;e.ResvSize+=t*e.mode_gr;var n=0;s.resvDrain_post=0,s.resvDrain_pre=0,0!=(a=e.ResvSize%8)&&(n+=a),(a=e.ResvSize-n-e.ResvMax)>0&&(Pt(0==a%8),Pt(a>=0),n+=a);var r=Math.min(8*s.main_data_begin,n)/8;s.resvDrain_pre+=8*r,n-=8*r,e.ResvSize-=8*r,s.main_data_begin-=r,s.resvDrain_post+=n,e.ResvSize-=n}},MPEGMode=_e,BitStream=ft,A.RIFF=B("RIFF"),A.WAVE=B("WAVE"),A.fmt_=B("fmt "),A.data=B("data"),A.readHeader=function(e){var t=new A,a=e.getUint32(0,!1);if(A.RIFF==a){e.getUint32(4,!0);if(A.WAVE==e.getUint32(8,!1)&&A.fmt_==e.getUint32(12,!1)){var s=e.getUint32(16,!0),n=20;switch(s){case 16:case 18:t.channels=e.getUint16(n+2,!0),t.sampleRate=e.getUint32(n+4,!0);break;default:throw"extended fmt chunk not implemented"}n+=s;for(var r=A.data,i=0;r!=a&&(a=e.getUint32(n,!1),i=e.getUint32(n+4,!0),r!=a);)n+=i+8;return t.dataLen=i,t.dataOffset=n+8,t}}};var Ft=function(e,t,a){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var s=new Lame,n=new g,r=new GainAnalysis,i=new BitStream,_=new Presets,o=new QuantizePVT,l=new Quantize,f=new Dt,c=new It,h=new R,u=new Reservoir,b=new Takehiro,m=new S,p=new M;s.setModules(r,i,_,o,l,f,c,h,p),i.setModules(r,p,c,f),h.setModules(i,c),_.setModules(s),l.setModules(i,u,o,b),o.setModules(b,u,s.enc.psy),u.setModules(i),b.setModules(o),f.setModules(s,i,c),n.setModules(m,p),m.setModules(c,h,_);var d=s.lame_init();d.num_channels=e,d.in_samplerate=t,d.brate=a,d.mode=MPEGMode.STEREO,d.quality=3,d.bWriteVbrTag=!1,d.disable_reservoir=!0,d.write_id3tag_automatic=!1;var v=s.lame_init_params(d);qt(0==v);var A=1152,B=0|1.25*A+7200,w=Yt(B);this.encodeBuffer=function(t,a){1==e&&(a=t),qt(t.length==a.length),t.length>A&&(A=t.length,w=Yt(B=0|1.25*A+7200));var n=s.lame_encode_buffer(d,t,a,t.length,w,0,B);return new Int8Array(w.subarray(0,n))},this.flush=function(){var e=s.lame_encode_flush(d,w,0,B);return new Int8Array(w.subarray(0,e))}},Ct=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Gt=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),jt=function(){function e(t){Ct(this,e),this.config={sampleRate:44100,bitRate:128},Object.assign(this.config,t),this.mp3Encoder=new Ft(1,this.config.sampleRate,this.config.bitRate),this.maxSamples=1152,this.samplesMono=null,this.clearBuffer()}return Gt(e,[{key:"clearBuffer",value:function(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function(e){this.dataBuffer.push(new Int8Array(e))}},{key:"floatTo16BitPCM",value:function(e,t){for(var a=0;a<e.length;a++){var s=Math.max(-1,Math.min(1,e[a]));t[a]=s<0?32768*s:32767*s}}},{key:"convertBuffer",value:function(e){var t=new Float32Array(e),a=new Int16Array(e.length);return this.floatTo16BitPCM(t,a),a}},{key:"encode",value:function(e){this.samplesMono=this.convertBuffer(e);for(var t=this.samplesMono.length,a=0;t>=0;a+=this.maxSamples){var s=this.samplesMono.subarray(a,a+this.maxSamples),n=this.mp3Encoder.encodeBuffer(s);this.appendToBuffer(n),t-=this.maxSamples}}},{key:"finish",value:function(){return this.appendToBuffer(this.mp3Encoder.flush()),this.dataBuffer}}]),e}();return function(){function e(t){Ct(this,e),this.config={bitRate:128,startRecordingAt:300,deviceId:"default"},this.activeStream=null,this.context=null,this.microphone=null,this.processor=null,this.startTime=0,Object.assign(this.config,t)}return Gt(e,[{key:"addMicrophoneListener",value:function(e){var t=this;this.activeStream=e,this.timerToStart=setTimeout(function(){delete t.timerToStart},this.config.startRecordingAt),this.microphone=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(0,1,1),this.processor.onaudioprocess=function(e){t.timerToStart||t.lameEncoder.encode(e.inputBuffer.getChannelData(0))},this.microphone.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"stop",value:function(){return this.processor&&this.microphone&&(this.microphone.disconnect(),this.processor.disconnect(),this.context&&"closed"!==this.context.state&&this.context.close(),this.processor.onaudioprocess=null,this.activeStream.getAudioTracks().forEach(function(e){return e.stop()})),this}},{key:"start",value:function(){var e=this;this.context=new AudioContext,this.config.sampleRate=this.context.sampleRate,this.lameEncoder=new jt(this.config);var t={deviceId:{exact:this.config.deviceId}};return new Promise(function(a,s){navigator.mediaDevices.getUserMedia({audio:t}).then(function(t){e.addMicrophoneListener(t),a(t)}).catch(function(e){s(e)})})}},{key:"getMp3",value:function(){var e=this,t=this.lameEncoder.finish();return new Promise(function(a,s){0===t.length?s(new Error("No buffer to send")):(a([t,new Blob(t,{type:"audio/mp3"})]),e.lameEncoder.clearBuffer())})}}]),e}()});
//# sourceMappingURL=index.min.js.map
